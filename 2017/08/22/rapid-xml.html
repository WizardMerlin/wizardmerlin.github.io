<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>rapid-xml | Merlin&#39;s Blog</title>
  <meta name="author" content="MerlinYu">
  
  <meta name="description" content="summary of server side network programming model">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="rapid-xml"/>
  <meta property="og:site_name" content="Merlin&#39;s Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="ico">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Merlin&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> rapid-xml</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> summary of server side network programming model
		 </div> <!-- alert -->
	  		

	  <p>本篇不会像 protocol-buffer 那样花很大的力气去讲解, 这里就是关于 Cpp对于解析XML的处理(序列化, 反序列化). 比较 SlimXml, TinyXml, RapidXml 发现, <a href="http://rapidxml.sourceforge.net/" target="_blank" rel="external">Rapid-Xml</a> 这个库性能优势明显.</p>
<blockquote>
<p>开源都是有坑的, 最好能自己填坑, 详细内容见文内; RapidXml并不如TinyXml那么稳定, 但谁叫它是Modern C++写的呢</p>
</blockquote>
<p>本文是对 Rapid-Xml 实践的讲解和总结.</p>
<a id="more"></a>
<h1 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h1><p>官网上的简介如下:<br>RapidXml is an attempt to create the fastest XML parser possible, while retaining useability, portability and reasonable W3C compatibility. It is an in-situ parser written in modern C++, with parsing speed approaching that of <code>strlen</code> function executed on the same data.</p>
<p>Integration with your project will be trivial, because entire library is contained in a single header file, and requires no building or configuration.</p>
<p>The author of RapidXml is <code>Marcin Kalicinski</code> .</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>注意 rapidxml 一个很重要的特性: RapidXml is an in-situ parser, which allows it to achieve very high parsing speed. </p>
<blockquote>
<p><code>In-situ</code> means that parser does not make copies of strings. Instead, it places pointers to the source text in the DOM hierarchy.</p>
</blockquote>
<p>换句话说:<br>Nodes and attributes produced by RapidXml do not own their name and value strings. They merely hold the pointers to them.</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>总共就4个头文件…直接下载吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ wget https://nchc.dl.sourceforge.net/project/rapidxml/rapidxml/rapidxml%201.13/rapidxml-1.13.zip</div><div class="line">$ unzip rapidxml-1.13.zip</div><div class="line">Archive:  rapidxml-1.13.zip</div><div class="line">   creating: rapidxml-1.13/</div><div class="line">  inflating: rapidxml-1.13/license.txt  </div><div class="line">  inflating: rapidxml-1.13/manual.html  </div><div class="line">  inflating: rapidxml-1.13/rapidxml.hpp  </div><div class="line">  inflating: rapidxml-1.13/rapidxml_iterators.hpp  </div><div class="line">  inflating: rapidxml-1.13/rapidxml_print.hpp  </div><div class="line">  inflating: rapidxml-1.13/rapidxml_utils.hpp </div><div class="line">$ sudo mv rapidxml-1.13 /usr/<span class="built_in">local</span>/include/rapidxml</div></pre></td></tr></table></figure>
<p>看了一下它的源文件, 代码量非常少, 总共不到4000行, 主要逻辑全部集中在 <code>rapidxml.hpp</code> 模板头文件中, 但是除去通用处理类, 比如parse_error, memory_pool等, 真正逻辑也很清晰.</p>
<p>源码就不分析了, 有时间再补上 (主要看class xml_base, xml_attribute等)</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>拿起来就是用(假设你已经知道了DOM解析, SAX解析, NODE, ROOT, Attribute, Document这些概念了).</p>
<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><p>解析一个C风格的字符串:(zero-terminated string)<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> rapidxml;</div><div class="line">xml_document&lt;&gt; doc;    <span class="comment">// character type defaults to char</span></div><div class="line">doc.parse&lt;<span class="number">0</span>&gt;(text);    <span class="comment">// 0 是默认flag</span></div></pre></td></tr></table></figure></p>
<p>菱形语法表示模板参数有默认值了, parse 的模板参数flag必须是一个编译时常量或者常量表达式, 此处的0是默认的.</p>
<p>doc就是DOM树的根(节点), 表示整个解析后的XML, 也表示整个内存池.</p>
<h3 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h3><p>读DOM树, 都需要借助 <code>xml_node</code> 和 <code>xml_attribute</code> 类, 样板代码:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Name of my first node is: "</span> &lt;&lt; doc.first_node()-&gt;name() &lt;&lt; <span class="string">"\n"</span>;</div><div class="line">xml_node&lt;&gt; *node = doc.first_node(<span class="string">"foobar"</span>);</div><div class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Node foobar has value "</span> &lt;&lt; node-&gt;value() &lt;&lt; <span class="string">"\n"</span>;</div><div class="line"><span class="keyword">for</span> (xml_attribute&lt;&gt; *attr = node-&gt;first_attribute();</div><div class="line">     attr; attr = attr-&gt;next_attribute())</div><div class="line">&#123;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Node foobar has attribute "</span> &lt;&lt; attr-&gt;name() &lt;&lt; <span class="string">" "</span>;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"with value "</span> &lt;&lt; attr-&gt;value() &lt;&lt; <span class="string">"\n"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>Nodes and attributes can be added/removed, and their contents changed. The below example creates a HTML document, whose sole contents is a link to google.com website:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">xml_document&lt;&gt; doc;</div><div class="line"><span class="comment">//node_element 代表node type的flag</span></div><div class="line">xml_node&lt;&gt; *node = doc.allocate_node(node_element, <span class="string">"a"</span>, <span class="string">"Google"</span>);</div><div class="line">doc.append_node(node);</div><div class="line">xml_attribute&lt;&gt; *attr = doc.allocate_attribute(<span class="string">"href"</span>, <span class="string">"google.com"</span>);</div><div class="line">node-&gt;append_attribute(attr);</div></pre></td></tr></table></figure>
<p>还是字符串问题, 上面的代码, 使用的是字符串常量, 所以不用担心字符串声明周期的合法性. 但是添加到node, attribute的string如果是普通变量, 那么在赋值(assign)的时候, 一定要保证string的生命周期和合法性, 毕竟node和string并不是实际存储内容(content), 而只是保留其地址的(浅复制).</p>
<p>所以这里, 作者推荐了一种做法来保证string的声明周期:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xml_document&lt;&gt; doc;</div><div class="line"><span class="keyword">char</span> *node_name = doc.allocate_string(name);        <span class="comment">// Allocate string and copy name into it</span></div><div class="line">xml_node&lt;&gt; *node = doc.allocate_node(node_element, node_name);  <span class="comment">// Set node name to node_name</span></div></pre></td></tr></table></figure></p>
<p>用内存池技术 <code>memory_pool::allocate_string()</code> , 来保证分配的string和doc的声明周期一致. (注意上面说过了, doc其实就是代表整个XML, 以及XML内存池)</p>
<h3 id="打印输出"><a href="#打印输出" class="headerlink" title="打印输出"></a>打印输出</h3><p>使用 <code>print()</code> 函数和 <code>operator&lt;&lt;()</code>, 打印 xml_document, xml_node 对象.<br>(头文件 <code>rapidxml_print.hpp</code> )</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> rapidxml;</div><div class="line">xml_document&lt;&gt; doc;    <span class="comment">// character type defaults to char</span></div><div class="line"><span class="comment">// ... some code to fill the document</span></div><div class="line"></div><div class="line"><span class="comment">// Print to stream using operator &lt;&lt;</span></div><div class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; doc;   </div><div class="line"></div><div class="line"><span class="comment">// Print to stream using print function, specifying printing flags</span></div><div class="line">print(<span class="built_in">std</span>::<span class="built_in">cout</span>, doc, <span class="number">0</span>);   <span class="comment">// 0 means default printing flags</span></div><div class="line"></div><div class="line"><span class="comment">// Print to string using output iterator</span></div><div class="line"><span class="built_in">std</span>::<span class="built_in">string</span> s;</div><div class="line">print(<span class="built_in">std</span>::back_inserter(s), doc, <span class="number">0</span>);</div><div class="line"></div><div class="line"><span class="comment">// Print to memory buffer using output iterator</span></div><div class="line"><span class="keyword">char</span> buffer[<span class="number">4096</span>];                      <span class="comment">// You are responsible for making the buffer large enough!</span></div><div class="line"><span class="keyword">char</span> *end = print(buffer, doc, <span class="number">0</span>);      <span class="comment">// end contains pointer to character after last printed character</span></div><div class="line">*end = <span class="number">0</span>;                               <span class="comment">// Add string terminator after XML</span></div></pre></td></tr></table></figure>
<p>稍稍注意下, 我用的1.13版本有点儿坑, <code>-std=c++11</code> 的时候, 还是会出现 “print_node()” 未定义的现象, 需要把它的源码定义 <code>print_node</code> 位置后移.</p>
<h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><p>细致的说一下相关的API(类, 函数, 常量等), 实际上作者对于相关API的命名真的非常清晰, 也符合一个从C开始到C++的开发人员的命名风格, 非常不错.</p>
<p>(总共4个头文件, 我就不指明是哪个头文件了)</p>
<p>名字空间 <code>rapidxml</code> :<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">enum node_type</div><div class="line">function parse_error_handler(const char *what, void *where)</div><div class="line">function print(OutIt out, const xml_node&lt; Ch &gt; &amp;node, int flags=0)</div><div class="line">function print(std::basic_ostream&lt; Ch &gt; &amp;out, const xml_node&lt; Ch &gt; &amp;node, int flags=0)</div><div class="line">function operator&lt;&lt;(std::basic_ostream&lt; Ch &gt; &amp;out, const xml_node&lt; Ch &gt; &amp;node)</div><div class="line"></div><div class="line">constant parse_no_data_nodes</div><div class="line">constant parse_no_element_values</div><div class="line">constant parse_no_string_terminators</div><div class="line">constant parse_no_entity_translation</div><div class="line">constant parse_no_utf8</div><div class="line">constant parse_declaration_node</div><div class="line">constant parse_comment_nodes</div><div class="line">constant parse_doctype_node</div><div class="line">constant parse_pi_nodes</div><div class="line">constant parse_validate_closing_tags</div><div class="line">constant parse_trim_whitespace</div><div class="line">constant parse_normalize_whitespace</div><div class="line">constant parse_default</div><div class="line">constant parse_non_destructive</div><div class="line">constant parse_fastest</div><div class="line">constant parse_full</div><div class="line">constant print_no_indenting</div></pre></td></tr></table></figure></p>
<p>特别说明一下 <code>enum node_type</code> :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">node_pi</div><div class="line">	A PI node. Name contains target. Value contains instructions.</div><div class="line">node_document</div><div class="line">	A document node. Name and value are empty.</div><div class="line">node_element</div><div class="line">	An element node. Name contains element name. Value contains text of first data node.</div><div class="line">node_data</div><div class="line">	A data node. Name is empty. Value contains data text.</div><div class="line">node_cdata</div><div class="line">	A CDATA node. Name is empty. Value contains data text.</div><div class="line">	</div><div class="line">---------------------------------------------------------------		</div><div class="line">node_comment </div><div class="line">	A comment node. Name is empty. Value contains comment text.</div><div class="line">node_declaration</div><div class="line">	A declaration node. Name and value are empty. Declaration parameters (version, encoding and standalone) are in node attributes.</div><div class="line">node_doctype 通常用 node_pi替代了</div><div class="line">	A DOCTYPE node. Name is empty. Value contains DOCTYPE text.</div></pre></td></tr></table></figure></p>
<p>类模板 <code>rapidxml::memory_pool</code><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">constructor memory_pool()</div><div class="line">destructor ~memory_pool()</div><div class="line">function allocate_node(node_type type, const Ch *name=0, const Ch *value=0, std::size_t name_size=0, std::size_t value_size=0)</div><div class="line">function allocate_attribute(const Ch *name=0, const Ch *value=0, std::size_t name_size=0, std::size_t value_size=0)</div><div class="line">function allocate_string(const Ch *source=0, std::size_t size=0)</div><div class="line">function clone_node(const xml_node&lt; Ch &gt; *source, xml_node&lt; Ch &gt; *result=0)</div><div class="line">function clear()</div><div class="line">function set_allocator(alloc_func *af, free_func *ff)</div></pre></td></tr></table></figure></p>
<p>类 <code>rapidxml::parse_error</code>, 一个继承自 std::exception的异常类:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">constructor <span class="title">parse_error</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *what, <span class="keyword">void</span> *where)</span></span></div><div class="line">function <span class="title">what</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">where</span><span class="params">()</span> <span class="keyword">const</span></div></pre></td></tr></table></figure></p>
<p>类模板 <code>rapidxml::xml_document</code> :<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">constructor <span class="title">xml_document</span><span class="params">()</span></span></div><div class="line">function <span class="title">parse</span><span class="params">(Ch *text)</span></div><div class="line">function <span class="title">clear</span><span class="params">()</span></div></pre></td></tr></table></figure></p>
<p>类模板 <code>rapidxml::xml_node</code> :<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function">constructor <span class="title">xml_node</span><span class="params">(node_type type)</span></span></div><div class="line">function <span class="title">type</span><span class="params">()</span> <span class="keyword">const</span> <span class="comment">//node有多种类型</span></div><div class="line">function <span class="title">type</span><span class="params">(node_type type)</span></div><div class="line"></div><div class="line">function <span class="title">document</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">first_node</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line">function <span class="title">last_node</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line"></div><div class="line">function <span class="title">previous_sibling</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line">function <span class="title">next_sibling</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line">function <span class="title">prepend_attribute</span><span class="params">(xml_attribute&lt; Ch &gt; *attribute)</span></div><div class="line"></div><div class="line"></div><div class="line">function <span class="title">first_attribute</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line">function <span class="title">last_attribute</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line"></div><div class="line">function <span class="title">prepend_node</span><span class="params">(xml_node&lt; Ch &gt; *child)</span></div><div class="line"></div><div class="line">function <span class="title">append_node</span><span class="params">(xml_node&lt; Ch &gt; *child)</span></div><div class="line">function <span class="title">insert_node</span><span class="params">(xml_node&lt; Ch &gt; *where, xml_node&lt; Ch &gt; *child)</span></div><div class="line"></div><div class="line">function <span class="title">remove_first_node</span><span class="params">()</span></div><div class="line">function <span class="title">remove_last_node</span><span class="params">()</span></div><div class="line">function <span class="title">remove_node</span><span class="params">(xml_node&lt; Ch &gt; *where)</span></div><div class="line">function <span class="title">remove_all_nodes</span><span class="params">()</span></div><div class="line"></div><div class="line">function <span class="title">append_attribute</span><span class="params">(xml_attribute&lt; Ch &gt; *attribute)</span></div><div class="line">function <span class="title">insert_attribute</span><span class="params">(xml_attribute&lt; Ch &gt; *where, xml_attribute&lt; Ch &gt; *attribute)</span></div><div class="line"></div><div class="line">function <span class="title">remove_first_attribute</span><span class="params">()</span></div><div class="line">function <span class="title">remove_last_attribute</span><span class="params">()</span></div><div class="line">function <span class="title">remove_attribute</span><span class="params">(xml_attribute&lt; Ch &gt; *where)</span></div><div class="line">function <span class="title">remove_all_attributes</span><span class="params">()</span></div></pre></td></tr></table></figure></p>
<p>注意操作属性也在node里面.</p>
<p>类模板 <code>rapidxml::xml_attribute</code> :<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function">constructor <span class="title">xml_attribute</span><span class="params">()</span></span></div><div class="line">function <span class="title">document</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">previous_attribute</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div><div class="line">function <span class="title">next_attribute</span><span class="params">(<span class="keyword">const</span> Ch *name=<span class="number">0</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> name_size=<span class="number">0</span>, <span class="keyword">bool</span> case_sensitive=<span class="literal">true</span>)</span> <span class="keyword">const</span></div></pre></td></tr></table></figure></p>
<p>类模板 <code>rapidxml::xml_base</code> :<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function">constructor <span class="title">xml_base</span><span class="params">()</span></span></div><div class="line">function <span class="title">name</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">name_size</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">value</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">value_size</span><span class="params">()</span> <span class="keyword">const</span></div><div class="line">function <span class="title">name</span><span class="params">(<span class="keyword">const</span> Ch *name, <span class="built_in">std</span>::<span class="keyword">size_t</span> size)</span></div><div class="line">function <span class="title">name</span><span class="params">(<span class="keyword">const</span> Ch *name)</span></div><div class="line">function <span class="title">value</span><span class="params">(<span class="keyword">const</span> Ch *value, <span class="built_in">std</span>::<span class="keyword">size_t</span> size)</span></div><div class="line">function <span class="title">value</span><span class="params">(<span class="keyword">const</span> Ch *value)</span></div><div class="line">function <span class="title">parent</span><span class="params">()</span> <span class="keyword">const</span></div></pre></td></tr></table></figure></p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>大致包括:</p>
<ul>
<li>创建一个XML文件</li>
<li>写,读,修改.</li>
</ul>
<p>创建一个XML文件:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iterator&gt; //back_inserter</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rapidxml/rapidxml.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rapidxml/rapidxml_utils.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rapidxml/rapidxml_print.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> document = rapidxml::xml_document&lt;&gt;;</div><div class="line"><span class="keyword">using</span> node = rapidxml::xml_node&lt;&gt;;</div><div class="line"></div><div class="line"><span class="keyword">using</span> rapidxml::node_pi;</div><div class="line"><span class="keyword">using</span> rapidxml::node_element;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">  document doc;</div><div class="line">  node *first = doc.allocate_node(node_pi, </div><div class="line">     doc.allocate_string(<span class="string">"xml version='1.0' encoding='utf-8'"</span>));</div><div class="line">  doc.append_node(first);</div><div class="line"></div><div class="line">  <span class="comment">//该节点作为根节点</span></div><div class="line">  node *root = doc.allocate_node(node_element, <span class="string">"config"</span>, <span class="literal">NULL</span>);</div><div class="line">  doc.append_node(root); </div><div class="line"></div><div class="line">  <span class="comment">//下面节点拥有子节点</span></div><div class="line">  node *color = doc.allocate_node(node_element, <span class="string">"color"</span>, <span class="literal">NULL</span>);</div><div class="line">  root-&gt;append_node(color);</div><div class="line"></div><div class="line">  color-&gt;append_node(doc.allocate_node(node_element,<span class="string">"red"</span>,<span class="string">"true"</span>));</div><div class="line">  color-&gt;append_node(doc.allocate_node(node_element,<span class="string">"green"</span>,<span class="string">"true"</span>));</div><div class="line">  color-&gt;append_node(doc.allocate_node(node_element,<span class="string">"blue"</span>,<span class="string">"true"</span>));</div><div class="line">  color-&gt;append_node(doc.allocate_node(node_element,<span class="string">"alpha"</span>,<span class="string">"true"</span>));</div><div class="line"></div><div class="line">  node *screen = doc.allocate_node(node_element,<span class="string">"screen"</span>,<span class="literal">NULL</span>);</div><div class="line">  screen-&gt;append_node(doc.allocate_node(node_element,<span class="string">"wide"</span>,<span class="string">"640"</span>));</div><div class="line">  screen-&gt;append_node(doc.allocate_node(node_element,<span class="string">"length"</span>,<span class="string">"480"</span>));</div><div class="line">  root-&gt;append_node(screen);</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">//下面节点拥有属性</span></div><div class="line">  node *mode = doc.allocate_node(node_element,<span class="string">"mode"</span>, <span class="string">"screen mode"</span>);</div><div class="line">  mode-&gt;append_attribute(doc.allocate_attribute(<span class="string">"fullscreen"</span>,<span class="string">"false"</span>));</div><div class="line">  root-&gt;append_node(mode);</div><div class="line"></div><div class="line">  <span class="comment">//打印试试</span></div><div class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> text;</div><div class="line">  rapidxml::print(<span class="built_in">std</span>::back_inserter(text), doc, <span class="number">0</span>);</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; text &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">  <span class="comment">//直接输出到指定流</span></div><div class="line">  <span class="built_in">std</span>::<span class="function">ofstream <span class="title">out</span><span class="params">(<span class="string">"config.xml"</span>)</span></span>;</div><div class="line">  out &lt;&lt; doc;</div><div class="line">  out.close();</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Linux平台下编译, 居然遇到了这样的坑:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/usr/local/include/rapidxml/rapidxml_print.hpp: In instantiation of </div><div class="line">‘OutIt rapidxml::internal::print_node(OutIt, const rapidxml::xml_node&lt;Ch&gt;*, int, int) [with OutIt = std\</div><div class="line">::back_insert_iterator&lt;std::basic_string&lt;char&gt; &gt;; Ch = char]’:</div><div class="line">/usr/local/include/rapidxml/rapidxml_print.hpp:390:36:   </div><div class="line">required from ‘OutIt rapidxml::print(OutIt, const rapidxml::xml_node&lt;Ch&gt;&amp;, int) [with OutIt = std::back_insert_ite\</div><div class="line">rator&lt;std::basic_string&lt;char&gt; &gt;; Ch = char]’</div><div class="line"></div><div class="line">main.cpp:52:51:   required from here</div><div class="line">/usr/local/include/rapidxml/rapidxml_print.hpp:115:37: </div><div class="line">error: ‘print_children’ was not declared in this scope, and no declarations were found by argument-dependent lookup \</div><div class="line">at the point of instantiation [-fpermissive]</div></pre></td></tr></table></figure></p>
<p>大致上说, <code>print_node</code> 被调用, 同时<code>rapidxml_print.hpp:115:37</code> 的 <code>print_children</code> 未定义.</p>
<p>然后看看源码, 发现, line 107 行源码是这样的:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Print node</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> OutIt, <span class="keyword">class</span> Ch&gt;</div><div class="line"><span class="function"><span class="keyword">inline</span> OutIt <span class="title">print_node</span><span class="params">(OutIt out, <span class="keyword">const</span> xml_node&lt;Ch&gt; *node, <span class="keyword">int</span> flags, <span class="keyword">int</span> indent)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="comment">// Print proper node type</span></div><div class="line">  <span class="keyword">switch</span> (node-&gt;type())</div><div class="line">    &#123;</div><div class="line"></div><div class="line">      <span class="comment">// Document</span></div><div class="line">    <span class="keyword">case</span> node_document:</div><div class="line">      out = print_children(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line"></div><div class="line">      <span class="comment">// Element</span></div><div class="line">    <span class="keyword">case</span> node_element:</div><div class="line">      out = print_element_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">      <span class="comment">// Data</span></div><div class="line">    <span class="keyword">case</span> node_data:</div><div class="line">      out = print_data_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">      <span class="comment">// CDATA</span></div><div class="line">    <span class="keyword">case</span> node_cdata:</div><div class="line">      out = print_cdata_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line"></div><div class="line">      <span class="comment">// Declaration</span></div><div class="line">    <span class="keyword">case</span> node_declaration:</div><div class="line">      out = print_declaration_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line"></div><div class="line">      <span class="comment">// Comment</span></div><div class="line">    <span class="keyword">case</span> node_comment:</div><div class="line">      out = print_comment_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">      <span class="comment">// Doctype</span></div><div class="line">    <span class="keyword">case</span> node_doctype:</div><div class="line">      out = print_doctype_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line"></div><div class="line">      <span class="comment">// Pi</span></div><div class="line">    <span class="keyword">case</span> node_pi:</div><div class="line">      out = print_pi_node(out, node, flags, indent);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line"></div><div class="line">      <span class="comment">// Unknown</span></div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      assert(<span class="number">0</span>);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">            </div><div class="line">  <span class="comment">// If indenting not disabled, add line break after node</span></div><div class="line">  <span class="keyword">if</span> (!(flags &amp; print_no_indenting))</div><div class="line">    *out = Ch(<span class="string">'\n'</span>), ++out;</div><div class="line"></div><div class="line">  <span class="comment">// Return modified iterator</span></div><div class="line">  <span class="keyword">return</span> out;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个 <code>print_node</code> 要调用具体的 <code>print_children</code> 或者 <code>print_element_node</code> 居然放在别人前面, 还没有前置声明.</p>
<p>修改一下源码(后移<code>print_node</code>函数以及在<code>print_children</code>函数前面防止前置声明), 才编译通过:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> OutIt, <span class="keyword">class</span> Ch&gt;</div><div class="line"><span class="function"><span class="keyword">inline</span> OutIt <span class="title">print_node</span><span class="params">(OutIt out, <span class="keyword">const</span> xml_node&lt;Ch&gt; *node, <span class="keyword">int</span> flags, <span class="keyword">int</span> indent)</span></span>;</div></pre></td></tr></table></figure></p>
<p>运行结果还不错:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&apos;1.0&apos; encoding=&apos;utf-8&apos; ?&gt;</div><div class="line">&lt;config&gt;</div><div class="line">	&lt;color&gt;</div><div class="line">		&lt;red&gt;true&lt;/red&gt;</div><div class="line">		&lt;green&gt;true&lt;/green&gt;</div><div class="line">		&lt;blue&gt;true&lt;/blue&gt;</div><div class="line">		&lt;alpha&gt;true&lt;/alpha&gt;</div><div class="line">	&lt;/color&gt;</div><div class="line">	&lt;screen&gt;</div><div class="line">		&lt;wide&gt;640&lt;/wide&gt;</div><div class="line">		&lt;length&gt;480&lt;/length&gt;</div><div class="line">	&lt;/screen&gt;</div><div class="line">	&lt;mode fullscreen=&quot;false&quot;&gt;screen mode&lt;/mode&gt;</div><div class="line">&lt;/config&gt;</div></pre></td></tr></table></figure></p>
<p>同时也生成了 config.xml.</p>
<p>下面读取该文件同时修改一下内容看看:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rapidxml/rapidxml.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rapidxml/rapidxml_utils.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rapidxml/rapidxml_print.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> rapidxml;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_info</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *str)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span></div><div class="line">&#123;</div><div class="line">  <span class="comment">//读入内存</span></div><div class="line">  file&lt;&gt; fdoc(<span class="string">"config.xml"</span>);</div><div class="line">  <span class="comment">//fdoc.data()即拿到数据字符串</span></div><div class="line"></div><div class="line">  <span class="comment">//保存到document对象中(实际上是解析进去的)</span></div><div class="line">  xml_document&lt;&gt; doc;</div><div class="line">  doc.parse&lt;<span class="number">0</span>&gt;(fdoc.data());</div><div class="line"></div><div class="line">  <span class="comment">//获取根节点</span></div><div class="line">  xml_node&lt;&gt; *root = doc.first_node();</div><div class="line">  <span class="comment">//if(root)&#123;&#125; //可以做一下检查, 检查节点是否存在</span></div><div class="line">  <span class="comment">//print_info(root-&gt;name());</span></div><div class="line"></div><div class="line">  <span class="comment">//获取根节点的第一个节点color</span></div><div class="line">  xml_node&lt;&gt;* node1 = root-&gt;first_node();</div><div class="line">  print_info(node1-&gt;name());</div><div class="line">  <span class="comment">//node1的子节点</span></div><div class="line">  xml_node&lt;&gt;* node11 = node1-&gt;first_node();</div><div class="line">  print_info(node11-&gt;name());</div><div class="line">  print_info(node11-&gt;value());</div><div class="line"></div><div class="line">  <span class="comment">//添加一个颜色 再保存</span></div><div class="line">  node1-&gt;append_node(doc.allocate_node(rapidxml::node_element, <span class="string">"yellow"</span>,<span class="string">"false"</span>));</div><div class="line">  <span class="comment">//删除color的子节点, &lt;alpha&gt;true&lt;/alpha&gt;</span></div><div class="line">  node1-&gt;remove_node(node11-&gt;next_sibling(<span class="string">"alpha"</span>));</div><div class="line"></div><div class="line">  <span class="comment">//remove_all_nodes()可以删除根节点的所有子节点</span></div><div class="line">  <span class="comment">//略</span></div><div class="line"></div><div class="line">  </div><div class="line"></div><div class="line"></div><div class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> text;</div><div class="line">  rapidxml::print(<span class="built_in">std</span>::back_inserter(text),doc,<span class="number">0</span>);</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;text&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">  <span class="comment">//写回去文件(默认就是文件存在则会覆盖原来的内容，不存在则会新建)</span></div><div class="line">  <span class="built_in">std</span>::<span class="function">ofstream <span class="title">out</span><span class="params">(<span class="string">"config.xml"</span>, <span class="built_in">std</span>::ios::out | <span class="built_in">std</span>::ios::trunc)</span></span>;</div><div class="line">  out &lt;&lt; doc;</div><div class="line">  out.close();</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">color</div><div class="line">red</div><div class="line">true</div><div class="line">&lt;config&gt;</div><div class="line">	&lt;color&gt;</div><div class="line">		&lt;red&gt;true&lt;/red&gt;</div><div class="line">		&lt;green&gt;true&lt;/green&gt;</div><div class="line">		&lt;blue&gt;true&lt;/blue&gt;</div><div class="line">		&lt;yellow&gt;false&lt;/yellow&gt;</div><div class="line">	&lt;/color&gt;</div><div class="line">	&lt;screen&gt;</div><div class="line">		&lt;wide&gt;640&lt;/wide&gt;</div><div class="line">		&lt;length&gt;480&lt;/length&gt;</div><div class="line">	&lt;/screen&gt;</div><div class="line">	&lt;mode fullscreen=&quot;false&quot;&gt;screen mode&lt;/mode&gt;</div><div class="line">&lt;/config&gt;</div></pre></td></tr></table></figure></p>
<p>上面, <code>doc.parse&lt;0&gt;(char_buffer)</code>, 不管你从哪里解析, 自定的 <code>char *</code>或者<code>file&lt;&gt; fdoc(&quot;config.xml&quot;)</code>的data(), 总之, 应该检查一下解析失败的情况:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> err;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="comment">//tmpbuf的生命周期必须到解析完  </span></div><div class="line">    doc.parse&lt;<span class="number">0</span>&gt;((<span class="keyword">char</span>*)tmpbuf);</div><div class="line">&#125; <span class="keyword">catch</span> (rapidxml::parse_error &amp;e) &#123;  </div><div class="line">    err = <span class="string">"parse xml error: "</span>;</div><div class="line">    err += e.what();</div><div class="line">    <span class="keyword">delete</span> []tmpbuf;</div><div class="line"></div><div class="line">    <span class="comment">//看看是不是返回给上一级调用者捕获</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>编辑节点:<br>先删除, 后添加, 并且insert是在指定节点前添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">xml_node&lt;&gt;* root = doc.first_node();</div><div class="line"></div><div class="line"><span class="comment">//删除color节点及其子节点.</span></div><div class="line">xml_node&lt;&gt;* delnode = root-&gt;first_node(<span class="string">"color"</span>);</div><div class="line">root-&gt;remove_node(delnode);</div><div class="line"></div><div class="line"><span class="comment">//找到要插入节点的位置</span></div><div class="line">xml_node&lt;&gt;* lnode = root-&gt;first_node(<span class="string">"screen"</span>);</div><div class="line"><span class="comment">//生成节点</span></div><div class="line">xml_node&lt;&gt;* mynode=doc.allocate_node(node_element,<span class="string">"address"</span>,<span class="string">"SH"</span>);</div><div class="line"></div><div class="line"><span class="comment">//添加节点</span></div><div class="line">root-&gt;insert_node(lnode,mynode);</div></pre></td></tr></table></figure></p>
<p>遍历当前节点的所有子节点:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rapidxml::xml_node&lt;<span class="keyword">char</span>&gt; * node = parent_node-&gt;first_node(<span class="string">"node name"</span>);</div><div class="line"><span class="keyword">for</span>( ; node != <span class="literal">NULL</span>; ) &#123;</div><div class="line">     <span class="comment">//do sth: name(), value()</span></div><div class="line"></div><div class="line">     <span class="comment">//更新节点</span></div><div class="line">     node = node-&gt;next_sibling();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>遍历当前节点所有属性:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">rapidxml::xml_attribute&lt;<span class="keyword">char</span>&gt; *attr </div><div class="line">	= node-&gt;first_attribute(<span class="string">"node name"</span>);</div><div class="line"><span class="keyword">for</span>( ; attr != <span class="literal">NULL</span>; ) &#123;</div><div class="line">     <span class="comment">//do sth</span></div><div class="line">    <span class="keyword">char</span> *value = attr-&gt;value();</div><div class="line"></div><div class="line">    attr = attr-&gt;next_attribute();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="尾巴"><a href="#尾巴" class="headerlink" title="尾巴"></a>尾巴</h1><p>一个简单的小的开源库, 虽然功能不是太强大, 但是完成日常的解析工作, 没有太多问题.</p>
<p>开源有坑, 记得填坑.</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a href="http://rapidxml.sourceforge.net/manual.html" target="_blank" rel="external">RAPIDXML Manual</a></li>
</ol>
<hr>
<p>who is sponsoring the site? - i shall say merlin (<code>wizardmerlin945@gmail.com</code>)<br>欢迎发邮件给我(生活问题，请高抬贵手)</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2017/08/22/rapid-json.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2017/08/21/protocol-buffer.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-08-22 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/codings/">codings<span>63</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/cpp/">cpp<span>22</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#引子"><span class="toc-article-text">引子</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#正文"><span class="toc-article-text">正文</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#安装"><span class="toc-article-text">安装</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#入门"><span class="toc-article-text">入门</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#解析"><span class="toc-article-text">解析</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#读取"><span class="toc-article-text">读取</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#修改"><span class="toc-article-text">修改</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#打印输出"><span class="toc-article-text">打印输出</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#详解"><span class="toc-article-text">详解</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#案例"><span class="toc-article-text">案例</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#补充"><span class="toc-article-text">补充</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#尾巴"><span class="toc-article-text">尾巴</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#参考资料"><span class="toc-article-text">参考资料</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2017 MerlinYu
  
     
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
