<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>jni | Merlin&#39;s Blog</title>
  <meta name="author" content="MerlinYu">
  
  <meta name="description" content="JNI技术">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="jni"/>
  <meta property="og:site_name" content="Merlin&#39;s Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="ico">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Merlin&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> jni</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> JNI技术
		 </div> <!-- alert -->
	  		

	  <p>“Java Native Interface” , 最初是在Android NDK编程的时候接触的, 不过个人对于客户端开发一直没有太大的兴趣, 所以自那之后也搁置了很久.</p>
<p>近期正好总结<code>跨语言编程实践</code>, 那么正好也就写一写, 就当写了一个中文的简要参考手册.</p>
<p>(参考资料中的第一本书推荐一下)</p>
<a id="more"></a>
<h1 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h1><p>跨语言的调用怎么弄? 这个话题, 太大了, 我倒是可以给你推荐一个框架, 脸书的Thrift; 这里只考虑 Java 和 C 的互相调用的话(调用方向不一样,方式也有稍稍不同, 复杂度也不一样), 就引出了JNI技术(JNI本身是native接口, 但在编程框架中更像一种协议), 专门针对Java和C交互.</p>
<p>我想最初设计这个框架的人一定考虑了至少3个问题:</p>
<ul>
<li>跨语言对象的对接问题</li>
<li>数据类型规格问题</li>
<li>调用效率问题</li>
</ul>
<p>JNI允许运行在Java虚拟机的Java代码与用其他语言(如C, C++和汇编)编写的库交互, 通过JNI, 可以在native code中完成至少下面的事情:</p>
<ul>
<li>创建、检查或者更新java对象</li>
<li>调用java方法</li>
<li>捕捉和抛出异常</li>
<li>加载class和获取class信息</li>
<li>运行时类型检查</li>
</ul>
<p>理论太啰嗦了, 不说了. 下面详细介绍这些技术, 以及常见的开发流程.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><h3 id="Java主调C代码"><a href="#Java主调C代码" class="headerlink" title="Java主调C代码."></a>Java主调C代码.</h3><p>也就是说实现部分是在C, Java部分就是起到简单的调用.</p>
<p>根据Java代码, 使用相应的编译器Javap生成本地访问头文件, 然后C代码中引用该头文件, 返回操作结果. Java代码中虚拟机运行时加载相应的本地代码(可能需要LoadLibrary), 从而完成java代码调用C代码.</p>
<p>流程归纳起来就是:<br>编译,加载,链接本地方法.</p>
<ul>
<li>编译:<br>java VM是多线程的 ，所以native libraries应该用多线程编译器来进行编译和链接。例如使用Sun Studio compiler编译器的时候，要为c++代码添加-mt标记；使用 GNU gcc compiler的时候，需添加-D_REENTRANT 或-D_POSIX_C_SOURCE</li>
<li><p>加载<br>native库通过System.loadLibrary方法进行加载。如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">package pkg;  </div><div class="line"></div><div class="line"><span class="keyword">class</span> Cls &#123; </div><div class="line"></div><div class="line">     <span class="function">native <span class="keyword">double</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i, String s)</span></span>; </div><div class="line"></div><div class="line">     <span class="keyword">static</span> &#123; </div><div class="line">         System.loadLibrary(“pkg_Cls”); </div><div class="line">     &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>系统会对library名会进行转换，在不同平台上有不同的转换方式，例如，Solaris系统转换pkg_Cls为libpkg_Cls.so，而Win32系统转换pkg_Cls为pkg_Cls.dll</p>
</li>
<li>链接<br>如果系统不支持动态链接，那么所有本地方法需要预链接到虚拟机，这种情况下，VM已经完成System.loadLibrary了。程序员也可以调用JNI函数RegisterNatives()来注册该类关联的本地方法</li>
</ul>
<h3 id="C主调Java代码"><a href="#C主调Java代码" class="headerlink" title="C主调Java代码"></a>C主调Java代码</h3><p>这个相对来说, 应该算作被动调用(需求比较少), C语言回调Java方法.</p>
<p>根据Java代码生成相应的C代码的步骤是一样的, <code>javap -jni 包名.类名</code>, 然后在本地代码中引入生成的头文件, 然后根据该头文件的函数, 给出函数实现.</p>
<p>但是在函数实现中, 就开始利用虚拟机的特性, 开始<code>反射</code>的写法了, 比如你的反射可能是这么写的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Class&lt;?&gt; instance = Class.forName(<span class="string">"com.example.Test"</span>);</div><div class="line">Method declearMethod = instance.getDeclaredMethod(<span class="string">"intMethod"</span>, <span class="keyword">new</span> Class[]&#123;&#125;);</div><div class="line">declearMethod.invoke(instance.newInstance(), <span class="keyword">new</span> Object[]&#123;&#125;);</div></pre></td></tr></table></figure>
<p>那么在本地代码写法也类似, 先要拿到Class类型, 之后找到方法(ID), 然后再进行调用处理, 核心代码可能是:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在某本地函数体内 </span></div><div class="line">jclass jclazz = (*env)-&gt;FindClass(env, <span class="string">"com/example/Test"</span>);</div><div class="line">jmethodID methodId = (*env)-&gt;GetMethodID(env, jclazz, <span class="string">"intMethod"</span>, <span class="string">"()V"</span><span class="comment">/*方法签名符号,约定参数和返回值*/</span>);</div><div class="line">(*env)-&gt;CallVoidMethod(env, jobject, methodId); <span class="comment">//jobject是本地函数默认的参数</span></div></pre></td></tr></table></figure>
<p>(如果是返回值的可能要用其他的JNI方法)</p>
<p>(方法签名可以看下面的规则, 得知其符号规则; 或者使用javap工具通过字节码拿到方法签名<code>javap -s</code>)</p>
<p>但是值得注意的是C回调Java代码, 是发生在Java代码调用C代码的时候, 发现自己被回调了; 毕竟运行都是在虚拟机的主导下(也就是说没有虚拟机环境是不行的). </p>
<p>C回调的方法一定要和jobject是同一个类型的(jobject实例所在的类), 如果你在该类的这个本地方法里, 调用其他Java类的方法, 还要增加处理:需要创建相关类的对象(就是拿到局部引用,AllObject或者NewObject方法)或者获取类的信息(静态方法调用GetStaticMethodID(), CallStaicVoidMethod()等), 例如<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//先FindClass 返回一个jclass对象clazz, 并且拿到methodID</span></div><div class="line">jobject obj = (*env)-&gt;AllocObject(env, clazz);</div><div class="line">(*env)-&gt;CallVoidMethod(env, obj, methodId);</div></pre></td></tr></table></figure></p>
<p>但是回调的场景, 最好还是放在同一个类吧, 不要跨类方法调用.</p>
<h2 id="本地方法规范"><a href="#本地方法规范" class="headerlink" title="本地方法规范"></a>本地方法规范</h2><p>Java方法, 如果转换(编译)到本地代码, 对应哪个方式其实是有讲究的, 例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> pkg;  </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls</span> </span>&#123; </div><div class="line">    <span class="comment">//对应本地方法名: Java_pkg_Cls_f__ILjava_lang_String_2, </span></div><div class="line">   <span class="comment">//参数列表:JNIEnv *env,jobject obj,jint i,jstring s</span></div><div class="line">    <span class="function"><span class="keyword">native</span> <span class="keyword">double</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i, String s)</span></span>; </div><div class="line"></div><div class="line">p&#125;</div></pre></td></tr></table></figure>
<p>下面就仔细讲解一下对应的映射或者编译规则.</p>
<h3 id="命名符号解析"><a href="#命名符号解析" class="headerlink" title="命名符号解析"></a>命名符号解析</h3><p>一个本地方法名有以下几个组成部分：</p>
<ul>
<li>前缀Java_</li>
<li>完整类名（类名中的.用_代替）</li>
<li>下划线_</li>
<li>方法名（方法名中的特殊字符需要转义）</li>
<li>参数签名（非必须，有重载方法的时候才需要），如果有重载的本地方法，需要再添加两个下划线_<em>，然后再添加方法签名（由java字段描述符描述，用</em>代替描述符中的包名分割/符，签名中的特殊字符需要转义）</li>
</ul>
<p>关于转义:</p>
<ul>
<li>_0XXXX    一个Unicode字符XXXX。注意小写是用来表示非ascii Unicode字符, 如:_0abcd与_0ABCD不相同</li>
<li><em>1        字符</em></li>
<li>_2        参数签名中的字符;</li>
<li>_3        参数签名中的字符[</li>
</ul>
<h3 id="类型符号解析"><a href="#类型符号解析" class="headerlink" title="类型符号解析"></a>类型符号解析</h3><p>注意这些规则, 对应的是用在函数或者参数名字上(java和c数据类型对应有另外一套规则)<br>命名中的类型(Java类型对应本地符号)规则, 如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Boolean		Z</div><div class="line">Byte		B</div><div class="line">Char		C</div><div class="line">Short		S</div><div class="line">Int		I</div><div class="line">Long		J (特殊)</div><div class="line">Float		F</div><div class="line">Double		D</div><div class="line">Void		V</div></pre></td></tr></table></figure></p>
<p>特殊的有数组和对象:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">数组:</div><div class="line">   &quot;[类型&quot; 表示, 如：int[]-&gt; [I, int[][]-&gt; [[I, Thread[]-&gt; [Ljava/lang/Thread;</div><div class="line"></div><div class="line">objects:</div><div class="line">   以&quot;L&quot;开头, 以&quot;;&quot;结尾, 用&quot;/&quot; 隔开的包及类名. 比如: Ljava/lang/String;</div><div class="line">   如果是嵌套类, 则用$来表示嵌套, 例 Landroid/os/FileUtils$FileStatus;</div></pre></td></tr></table></figure></p>
<h3 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h3><p>一个Java方法, 编译到native code会自然多出两个参数, 一个代表JNI接口指针类型(Java虚拟机环境), 另外一个是对象实例的引用(通俗来说就是this指针, 当然进程方法可以不用).</p>
<p>例如:<br>Java代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> pkg;  </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls</span> </span>&#123; </div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">native</span> <span class="keyword">double</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i, String s)</span></span>; </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编译到C代码就是:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*c和c++在使用JNI接口的时候有点不一致, </span></div><div class="line">   请仔细观察通过env调用接口的调用方式 */</div><div class="line"></div><div class="line"><span class="comment">//C版本</span></div><div class="line"><span class="function">jdouble <span class="title">Java_pkg_Cls_f__ILjava_lang_String_2</span> <span class="params">(</span></span></div><div class="line">     JNIEnv *env,        <span class="comment">/* interface pointer */</span></div><div class="line">     jobject obj,        <span class="comment">/* "this" pointer */</span></div><div class="line">     jint i,             <span class="comment">/* argument #1 */</span></div><div class="line">     jstring s)          <span class="comment">/* argument #2 */</span></div><div class="line">&#123;</div><div class="line">     <span class="comment">/* Obtain a C-copy of the Java string */</span></div><div class="line">     <span class="keyword">const</span> <span class="keyword">char</span> *str = (*env)-&gt;GetStringUTFChars(env, s, <span class="number">0</span>);</div><div class="line"></div><div class="line">     <span class="comment">/* process the string */</span></div><div class="line">     ...</div><div class="line"></div><div class="line">     <span class="comment">/* Now we are done with str */</span></div><div class="line">     (*env)-&gt;ReleaseStringUTFChars(env, s, str);</div><div class="line"></div><div class="line">     <span class="keyword">return</span> ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//C++版本</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="comment">/* specify the C calling convention */</span>  </div><div class="line">jdouble Java_pkg_Cls_f__ILjava_lang_String_2 ( </div><div class="line"></div><div class="line">     JNIEnv *env,        <span class="comment">/* interface pointer */</span> </div><div class="line">     jobject obj,        <span class="comment">/* "this" pointer */</span> </div><div class="line">     jint i,             <span class="comment">/* argument #1 */</span> </div><div class="line">     jstring s)          <span class="comment">/* argument #2 */</span> </div><div class="line">&#123; </div><div class="line"></div><div class="line">     <span class="keyword">const</span> <span class="keyword">char</span> *str = env-&gt;GetStringUTFChars(s, <span class="number">0</span>); </div><div class="line">     ... </div><div class="line"></div><div class="line">     env-&gt;ReleaseStringUTFChars(s, str); </div><div class="line"></div><div class="line">     <span class="keyword">return</span> ... </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="对象类型解析"><a href="#对象类型解析" class="headerlink" title="对象类型解析"></a>对象类型解析</h3><p>本地代码中的参数, 才不管你Java类的具体类型, 统一jobject类型;<br>当然也可以对应更细致(也不那么细致):<br><img src="http://omotkhw3y.bkt.clouddn.com/jobject.jpg" alt="jobject"></p>
<p>java对象引用:</p>
<ul>
<li>基本类型（如整型，字符等）在Java和native之间是采用值传递</li>
<li>Java对象采用的是引用(地址)传递(Java语言本身封装了指针)</li>
</ul>
<p>全局引用&amp;弱全局引用, 局部引用:</p>
<ul>
<li>局部引用在方法调用的时候有效，在方法调用结束之后会自动释放</li>
<li>全局引用会一直可用，直到显式地对其进行释放</li>
<li>弱全局引用跟全局引用的区别是弱全局引用持有的java对象可以被VM进行回收，所以才使用弱全局引用前，我们需要对其进行检测，看它对应的对象是否被回收了</li>
</ul>
<p>JNIENV方法:</p>
<ul>
<li>返回的Java对象都是局部引用</li>
<li>可以接受全局引用和全局引用</li>
</ul>
<p>native方法: (C方法)</p>
<ul>
<li>可以返回局部或者全局引用</li>
<li>接收的一般是局部引用(Java对象)</li>
</ul>
<p>并且JNI允许程序从局部引用创建一个全局引用.</p>
<p>native代码中的局部的对象, 该怎么释放?</p>
<ul>
<li>在方法调用结束之后，我们依赖VM去帮我们释放所有局部引用</li>
<li>以下几种情况下，我们应该显式地释放局部引用:<ul>
<li>方法中创建了一个比较大的java对象的，并持有其局部引用，使用完之后，如果接下来都不再需要使用了，如果仍然不对它进行释放的话，在方法结束之前，这个对象都不会进行释放，这样会对资源造成浪费</li>
<li>JNI会将创建的局部引用都存储在一个局部引用表中，如果这个表超过了最大容量限制，就会造成局部引用表溢出，使程序崩溃。比如在一个循环中创建局部引用，最好在每一轮循环中释放局部引用，否则随着循环次数增加，很可能就内存溢出了</li>
</ul>
</li>
</ul>
<p>局部引用仅仅在其创建的线程内有效(也就是占用的是本地代码的栈空间), native代码不能跨线程传递局部引用.</p>
<h3 id="类型别名解析"><a href="#类型别名解析" class="headerlink" title="类型别名解析"></a>类型别名解析</h3><p>上面的jint, 其实是JNI定义的别名(具体对应什么可以自己定义), 对应的可能是标准C中的long, 其实你也可以使用c语言标准中的int类型.</p>
<p>详细的信息可以参考下面:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Java 类型   JNI类型别名		 描述</div><div class="line">boolean	    jboolean		 unsigned char, 8 bits</div><div class="line">byte	    jbyte		 signed char, 8 bits</div><div class="line">char	    jchar		 unsigned short, 16 bits</div><div class="line">short	    jshort		 signed short, 16 bits</div><div class="line">int	    jint		 signed long, 32 bits</div><div class="line">long	    jlong		 __int64, signed long long,  64 bits</div><div class="line">float	    jfloat		 float, 32 bits</div><div class="line">double	    jdouble		 double 64 bits</div><div class="line">void	    void		 N/A</div></pre></td></tr></table></figure></p>
<p><img src="http://omotkhw3y.bkt.clouddn.com/jni.jpg" alt="别名"><br>当然你也可以选择使用或者不用:(默认使用)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#define JNI_FALSE  0 </div><div class="line">#define JNI_TRUE   1</div></pre></td></tr></table></figure></p>
<p>注意到char使用的双字节编码, 而不是单字节编码，所以Java虚拟机的UTF-8字符串不可能有嵌入的空值; 并且不支持标准的四字节编码，用 two-times-three-byte 格式代替</p>
<h3 id="调用Java方法"><a href="#调用Java方法" class="headerlink" title="调用Java方法"></a>调用Java方法</h3><p>JNI允许native代码访问对象的成员以及调用它的方法，通过两个步骤即可实现访问，比如，我们需要调用cls中的f方法：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">jmethodID mid = env-&gt;GetMethodID(cls, “f”, “(ILjava/lang/String;)D”);<span class="comment">//mid可以重复使用</span></div><div class="line">jdouble result = env-&gt;CallDoubleMethod(obj, mid, <span class="number">10</span>, str);</div></pre></td></tr></table></figure></p>
<p>但是需要注意的是，字段ID或方法ID并不能防止VM卸载该类. 当类被卸载后, 方法ID和字段ID将变成不可用的. 因此，我们需要确保： </p>
<ul>
<li>持有class的引用，让它不被卸载，或者 </li>
<li>重新获取方法id或者字段id</li>
</ul>
<p>关于<code>jmethodID</code>:<br>在C中, 字段和方法的 ID 是一个指向结构体的指针:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> _jfieldID;                       <span class="comment">/* opaque structure */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> _jfieldID* jfieldID;     <span class="comment">/* field IDs */</span></div><div class="line"></div><div class="line"><span class="keyword">struct</span> _jmethodID;                      <span class="comment">/* opaque structure */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> _jmethodID* jmethodID;   <span class="comment">/* method IDs */</span></div></pre></td></tr></table></figure></p>
<h3 id="方法签名"><a href="#方法签名" class="headerlink" title="方法签名"></a>方法签名</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//方法签名为：(ILjava/lang/String;[I)J </span></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="title">f</span> <span class="params">(<span class="keyword">int</span> n, String s, <span class="keyword">int</span>[] arr)</span></span>;</div></pre></td></tr></table></figure>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>JNI不对空指针或非法参数类型等错误进行检测, 因为:</p>
<ul>
<li>检查所有可能的错误会降低方法执行的性能</li>
<li>在很多时候，没有足够的运行时信息去进行检测<br>程序员不得传递一个非法指针或者错误的类型给JNI函数, 否则可能会导致系统异常货虚拟机崩溃.</li>
</ul>
<p>JNI允许本地方法抛出处理任何异常，也可以处理Java中抛出的异常，剩下没有处理的异常会继续给VM处理.</p>
<h3 id="Java部分处理"><a href="#Java部分处理" class="headerlink" title="Java部分处理:"></a>Java部分处理:</h3><p>大多数情况下，JNI提供的方法通过返回错误码或者抛出java异常来处理错误，因此，程序中可以:</p>
<ul>
<li>检查JNI函数返回值</li>
<li>调用 ExceptionOccurred() 方法，获取方法中抛出的异常</li>
</ul>
<p>有两种情况下，程序需要优先检测java异常而不是先检测返回码:</p>
<ul>
<li>通过JNI调用Java方法的时候，需要ExceptionOccurred()检测是否在Java方法中抛出了异常</li>
<li>一些访问数组的方法，它不返回错误码，但是会抛出 ArrayIndexOutOfBoundsException 或者 ArrayStoreException异常</li>
</ul>
<h3 id="本地部分处理"><a href="#本地部分处理" class="headerlink" title="本地部分处理"></a>本地部分处理</h3><p>有两种方法可以在本地方法中处理异常:</p>
<ul>
<li>检测到异常的时候立即返回，异常将会在调用该本地代码的地方抛出</li>
<li>在本地方法中调用ExceptionClear()清除异常，处理接下来的逻辑</li>
</ul>
<p>异常抛出的时，本地方法需清除异常后，才能继续调用其他JNI接口方法.</p>
<p>有异常发生后，只有以下方法才能被安全调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">ExceptionOccurred()</div><div class="line">ExceptionDescribe()</div><div class="line">ExceptionClear()</div><div class="line">ExceptionCheck()</div><div class="line">ReleaseStringChars()</div><div class="line">ReleaseStringUTFChars()</div><div class="line">ReleaseStringCritical()</div><div class="line">Release&lt;Type&gt;ArrayElements()</div><div class="line">ReleasePrimitiveArrayCritical()</div><div class="line">DeleteLocalRef()</div><div class="line">DeleteGlobalRef()</div><div class="line">DeleteWeakGlobalRef()</div><div class="line">MonitorExit()</div><div class="line">PushLocalFrame()</div><div class="line">PopLocalFrame()</div></pre></td></tr></table></figure></p>
<h2 id="JNI接口详解"><a href="#JNI接口详解" class="headerlink" title="JNI接口详解"></a>JNI接口详解</h2><p>花时间阅读那个 <code>jni.h</code>, 以及参考文档.</p>
<p>JNI函数必须接受一个非空对象，你必须保证传入的参数不为空，JNI函数不需要再对它进行空指针判断.</p>
<h3 id="返回码说明"><a href="#返回码说明" class="headerlink" title="返回码说明"></a>返回码说明</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JNI_OK          (0)         <span class="comment">/* no error */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JNI_ERR         (-1)        <span class="comment">/* generic error */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JNI_EDETACHED   (-2)        <span class="comment">/* thread detached from the VM */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JNI_EVERSION    (-3)        <span class="comment">/* JNI version error */</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JNI_COMMIT      1           <span class="comment">/* copy content, do not free buffer */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JNI_ABORT       2           <span class="comment">/* free buffer w/o copying back */</span></span></div></pre></td></tr></table></figure>
<h3 id="接口代码说明"><a href="#接口代码说明" class="headerlink" title="接口代码说明"></a>接口代码说明</h3><p>该部分比较多(1000多行), 有一定的注释<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回本地方法接口的版本</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> *</div><div class="line"> * @return 高16位返回主版本号，低16位返回次版本号, </div><div class="line">  如在JDK/JRE 1.6中，返回0x00010006</div><div class="line">  也有可能返回 JNI_EDETACHED 和 JNI_EVERSION 错误码</div><div class="line"> */</div><div class="line">jint (*GetVersion)(JNIEnv *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 从二进制的.class的数据缓冲区中加载类</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param name UTF8编码的需要加载的类的名字</div><div class="line"> * @param loader 类加载器</div><div class="line"> * @param buf 包含.class字节码的数组</div><div class="line"> * @param bufLen 长度</div><div class="line"> *</div><div class="line"> * @return class对象或NULL</div><div class="line"> *</div><div class="line"> * @throws ClassFormatError 不是有效的class数据</div><div class="line"> * @throws ClassCircularityError 类或接口是自身的父类或自身继承了该接口</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> * @throws SecurityException 如果该类是属于java包的</div><div class="line"> */</div><div class="line">jclass (*DefineClass)(JNIEnv *, <span class="keyword">const</span> <span class="keyword">char</span> *, jobject, <span class="keyword">const</span> jbyte *, jsize);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 用于加载本地定义的类</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param name 完整的包名("/"代替".") 或 数组类型字段描述("["开头，紧跟签名描述)，</div><div class="line">    如"java/lang/String" for java.lang.String, </div><div class="line">      "[Ljava/lang/Object;" for java.lang.Object[]</div><div class="line"> *</div><div class="line"> * @return class对象或NULL</div><div class="line"> *</div><div class="line"> * @throws ClassFormatError 不是有效的class数据</div><div class="line"> * @throws ClassCircularityError 类或接口是自身的父类或自身继承了该接口</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> * @throws NoClassDefFoundError 找不到name对应的class类</div><div class="line"> */</div><div class="line">jclass (*FindClass)(JNIEnv *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 从java.lang.reflect.Method 或 java.lang.reflect.Constructor 获取method ID</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param method java.lang.reflect.Method 或 java.lang.reflect.Constructor对象</div><div class="line"> *</div><div class="line"> * @return 方法ID</div><div class="line"> */</div><div class="line">jmethodID (*FromReflectedMethod)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 从java.lang.reflect.Field获取field ID</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param field java.lang.reflect.Field对象</div><div class="line"> *</div><div class="line"> * @return field ID</div><div class="line"> */</div><div class="line">jfieldID (*FromReflectedField)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 从method ID获取 java.lang.reflect.Method 或 java.lang.reflect.Constructor 对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param cls 该方法的类对象</div><div class="line"> * @param methodID 方法ID</div><div class="line"> * @param isStatic 是否静态方法</div><div class="line"> *</div><div class="line"> * @return java.lang.reflect.Method 或 java.lang.reflect.Constructor 对象</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jobject (*ToReflectedMethod)(JNIEnv *, jclass, jmethodID, jboolean);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 如果clazz不是class对象或接口，则返回该class的超类</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> *</div><div class="line"> * @return 返回输入类的父类 或 NULL</div><div class="line"> */</div><div class="line">jclass (*GetSuperclass)(JNIEnv *, jclass);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * class1是否可以安全地转换为class2，以下三种情况会返回TRUE</div><div class="line"> * 1. 当class1和class2是同一个java class的引用</div><div class="line"> * 2. class1是class2的子类</div><div class="line"> * 3. class2是class1的某个接口</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz1 class1</div><div class="line"> * @param clazz2 class2</div><div class="line"> *</div><div class="line"> * @return JNI_TRUE or JNI_FALSE</div><div class="line"> */</div><div class="line">jboolean (*IsAssignableFrom)(JNIEnv *, jclass, jclass);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据 field ID 获取 java.lang.reflect.Field 对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param cls 该方法的类对象</div><div class="line"> * @param fieldID 字段ID</div><div class="line"> * @param isStatic 是否静态变量</div><div class="line"> *</div><div class="line"> * @return java.lang.reflect.Field 对象</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jobject (*ToReflectedField)(JNIEnv *, jclass, jfieldID, jboolean);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 抛出异常</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java.lang.Throwable 对象</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> *</div><div class="line"> * @throws Throwable</div><div class="line"> */</div><div class="line">jint (*Throw)(JNIEnv *, jthrowable);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据clazz和message构造一个异常对象，并将它抛出</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz java.lang.Throwable的子类</div><div class="line"> * @param message 错误信息</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> *</div><div class="line"> * @throws Throwable</div><div class="line"> */</div><div class="line">jint (*ThrowNew)(JNIEnv *, jclass, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 判断是否有异常抛出，在调用ExceptionClear()或java代码处理了exception之前，都可以用这个方法判断是否有异常</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> *</div><div class="line"> * @return 异常对象 or NULL</div><div class="line"> */</div><div class="line">jthrowable (*ExceptionOccurred)(JNIEnv *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 打印异常信息</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*ExceptionDescribe)(JNIEnv *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 清除所有已抛出的异常</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*ExceptionClear)(JNIEnv *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 抛出致命错误并且不希望虚拟机进行恢复。无返回值</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param msg 错误信息</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*FatalError)(JNIEnv *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 创建一个新的本地引用帧</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param capacity 容量</div><div class="line"> *</div><div class="line"> * @return 0：成功，负数：失败</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError</div><div class="line"> */</div><div class="line">jint (*PushLocalFrame)(JNIEnv *, jint);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 弹出当前本地引用帧，释放所有本地引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param result</div><div class="line"> *</div><div class="line"> * @return</div><div class="line"> */</div><div class="line">jobject (*PopLocalFrame)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 为传入的obj创建全局引用，obj可以是全局引用也可以是局部引用。全局引用需要调用DeleteGlobalRef来释放</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj 全局或局部引用</div><div class="line"> *</div><div class="line"> * @return 全局引用 or NULL(内存不足)</div><div class="line"> */</div><div class="line">jobject (*NewGlobalRef)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 释放全局引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param globalRef 全局引用</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*DeleteGlobalRef)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 释放局部引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param localRef 局部引用</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*DeleteLocalRef)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 判断两个引用是否同一java对象的引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param ref1 引用1</div><div class="line"> * @param ref2 引用2</div><div class="line"> *</div><div class="line"> * @return JNI_TRUE:两个引用指向同一个java对象</div><div class="line"> */</div><div class="line">jboolean (*IsSameObject)(JNIEnv *, jobject, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 为传入的ref创建局部引用，ref可以是全局引用也可以是局部引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param ref 全局或局部引用</div><div class="line"> *</div><div class="line"> * @return 局部引用 or NULL</div><div class="line"> */</div><div class="line">jobject (*NewLocalRef)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 确保当前线程可以创建capacity个局部引用。在进入本地方法时，VM确保可以可以创建最少16个局部引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param capacity 局部引用个数</div><div class="line"> *</div><div class="line"> * @return 0：成功，负数：失败</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jint (*EnsureLocalCapacity)(JNIEnv *, jint);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 创建一个新的java对象（不会调用对象的构造方法）</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz 非数组class对象</div><div class="line"> *</div><div class="line"> * @return java对象</div><div class="line"> *</div><div class="line"> * @throws InstantiationException clazz是一个接口或抽象类</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jobject (*AllocObject)(JNIEnv *, jclass);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 构造一个新的java对象，method ID指用以生成该类的构造方法，method ID必须是通过GetMethodID()获得</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz 非数组class对象</div><div class="line"> * @param ... 传递给构造方法的参数</div><div class="line"> *</div><div class="line"> * @return java对象 or NULL(对象构造失败)</div><div class="line"> *</div><div class="line"> * @throws InstantiationException clazz是一个接口或抽象类</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jobject (*NewObject)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 构造一个新的java对象，method ID指用以生成该类的构造方法，method ID必须是通过GetMethodID()获得</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz 非数组class对象</div><div class="line"> * @param args va_list结构，里面有传递给构造方法的参数</div><div class="line"> *</div><div class="line"> * @return java对象 or NULL(对象构造失败)</div><div class="line"> *</div><div class="line"> * @throws InstantiationException clazz是一个接口或抽象类</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jobject (*NewObjectV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 构造一个新的java对象，method ID指用以生成该类的构造方法，method ID必须是通过GetMethodID()获得</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz 非数组class对象</div><div class="line"> * @param args 参数数组，里面是传递给构造方法的参数</div><div class="line"> *</div><div class="line"> * @return java对象 or NULL(对象构造失败)</div><div class="line"> *</div><div class="line"> * @throws InstantiationException clazz是一个接口或抽象类</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jobject (*NewObjectA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回对象对应的class对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj 非空java对象</div><div class="line"> *</div><div class="line"> * @return class对象</div><div class="line"> */</div><div class="line">jclass (*GetObjectClass)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 判断obj是否clazz的实例对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象</div><div class="line"> * @param clazz class对象</div><div class="line"> *</div><div class="line"> * @return</div><div class="line"> */</div><div class="line">jboolean (*IsInstanceOf)(JNIEnv *, jobject, jclass);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回非静态方法的method ID</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param name 方法名</div><div class="line"> * @param sig 方法签名</div><div class="line"> *</div><div class="line"> * @return 方法ID or NULL</div><div class="line"> *</div><div class="line"> * @throws NoSuchMethodError 找不到对应的方法</div><div class="line"> * @throws ExceptionInInitializerError class初始化失败</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jmethodID (*GetMethodID)(JNIEnv *, jclass, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Call&lt;type&gt;Method(JNIEnv *env, jobject obj, jmethodID methodID, ...);调用参数放到可变参数中</div><div class="line"> * Call&lt;type&gt;MethodA(JNIEnv *env, jobject obj, jmethodID methodID, const jvalue *args);调用参数放入jvalue数组</div><div class="line"> * Call&lt;type&gt;MethodV(JNIEnv *env, jobject obj, jmethodID methodID, va_list args);调用参数放入va_list结构中</div><div class="line"> *</div><div class="line"> * 以上三组调用接口都是根据 method ID调用java实例方法（非静态方法）的接口，其中method ID是通过GetMethodID()获取的</div><div class="line"> * 当这些方法用于调用java对象的私有方法或构造函数时，method ID必须从obj的真实类获取，而不应从其某个父类获取</div><div class="line"> * &lt;type&gt;是方法的返回类型，三类接口间唯一的区别是methodID参数之后调用参数的不同</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象</div><div class="line"> * @param methodID 方法ID</div><div class="line"> * @param args 调用参数</div><div class="line"> *</div><div class="line"> * @return java方法返回结果</div><div class="line"> *</div><div class="line"> * @throws java方法中可能抛出的异常</div><div class="line"> */</div><div class="line">jobject (*CallObjectMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jobject (*CallObjectMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jobject (*CallObjectMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jboolean (*CallBooleanMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jboolean (*CallBooleanMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jboolean (*CallBooleanMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jbyte (*CallByteMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jbyte (*CallByteMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jbyte (*CallByteMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jchar (*CallCharMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jchar (*CallCharMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jchar (*CallCharMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jshort (*CallShortMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jshort (*CallShortMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jshort (*CallShortMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jint (*CallIntMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jint (*CallIntMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jint (*CallIntMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jlong (*CallLongMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jlong (*CallLongMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jlong (*CallLongMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jfloat (*CallFloatMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jfloat (*CallFloatMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jfloat (*CallFloatMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line">jdouble (*CallDoubleMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line">jdouble (*CallDoubleMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line">jdouble (*CallDoubleMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line"><span class="keyword">void</span> (*CallVoidMethod)(JNIEnv *, jobject, jmethodID, ...);</div><div class="line"><span class="keyword">void</span> (*CallVoidMethodV)(JNIEnv *, jobject, jmethodID, va_list);</div><div class="line"><span class="keyword">void</span> (*CallVoidMethodA)(JNIEnv *, jobject, jmethodID, jvalue *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * CallNonvirtual&lt;type&gt;Method(JNIEnv *env, jobject obj, jclass clazz, jmethodID methodID, ...);调用参数放到可变参数中</div><div class="line"> * CallNonvirtual&lt;type&gt;MethodA(JNIEnv *env, jobject obj, jclass clazz, jmethodID methodID, const jvalue *args);调用参数放入jvalue数组</div><div class="line"> * CallNonvirtual&lt;type&gt;MethodV(JNIEnv *env, jobject obj, jclass clazz, jmethodID methodID, va_list args);调用参数放入va_list结构中</div><div class="line"> *</div><div class="line"> * 以上三组调用接口都是根据 method ID 和 class 调用java实例方法（非静态方法）的接口，其中method ID是基于clazz通过GetMethodID()获取的</div><div class="line"> * &lt;type&gt;是方法的返回类型，三类接口间唯一的区别是methodID参数之后调用参数的不同</div><div class="line"> * 注意，和Call&lt;type&gt;Method不同，如果子类重写了父类的方法，Call&lt;type&gt;Method调用的是子类的方法，如果想调用父类的方法，</div><div class="line"> * 则需要用CallNonvirtual&lt;type&gt;Method，这个方法可以传入父类的class和父类的method id，从而达到调用父类方法的效果</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param obj java对象</div><div class="line"> * @param methodID 方法ID</div><div class="line"> * @param args 调用参数</div><div class="line"> *</div><div class="line"> * @return java方法返回结果</div><div class="line"> *</div><div class="line"> * @throws java方法中可能抛出的异常</div><div class="line"> */</div><div class="line">jobject (*CallNonvirtualObjectMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jobject (*CallNonvirtualObjectMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jobject (*CallNonvirtualObjectMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jboolean (*CallNonvirtualBooleanMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jboolean (*CallNonvirtualBooleanMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jboolean (*CallNonvirtualBooleanMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jbyte (*CallNonvirtualByteMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jbyte (*CallNonvirtualByteMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jbyte (*CallNonvirtualByteMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jchar (*CallNonvirtualCharMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jchar (*CallNonvirtualCharMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jchar (*CallNonvirtualCharMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jshort (*CallNonvirtualShortMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jshort (*CallNonvirtualShortMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jshort (*CallNonvirtualShortMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jint (*CallNonvirtualIntMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jint (*CallNonvirtualIntMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jint (*CallNonvirtualIntMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jlong (*CallNonvirtualLongMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jlong (*CallNonvirtualLongMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jlong (*CallNonvirtualLongMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jfloat (*CallNonvirtualFloatMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jfloat (*CallNonvirtualFloatMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jfloat (*CallNonvirtualFloatMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line">jdouble (*CallNonvirtualDoubleMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line">jdouble (*CallNonvirtualDoubleMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line">jdouble (*CallNonvirtualDoubleMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line"><span class="keyword">void</span> (*CallNonvirtualVoidMethod)(JNIEnv *, jobject, jclass, jmethodID, ...);</div><div class="line"><span class="keyword">void</span> (*CallNonvirtualVoidMethodV)(JNIEnv *, jobject, jclass, jmethodID, va_list);</div><div class="line"><span class="keyword">void</span> (*CallNonvirtualVoidMethodA)(JNIEnv *, jobject, jclass, jmethodID, jvalue *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据class对象获取非静态成员变量的field ID</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param name 变量名</div><div class="line"> * @param sig 变量签名</div><div class="line"> *</div><div class="line"> * @return field ID or NULL</div><div class="line"> *</div><div class="line"> * @throws NoSuchFieldError 找不到对应的变量ID</div><div class="line"> * @throws ExceptionInInitializerError class初始化失败</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jfieldID (*GetFieldID)(JNIEnv *, jclass, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据field id取出对象中相应的变量值，field Id通过GetFieldID()获取</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象</div><div class="line"> * @param fieldID 有效的field id</div><div class="line"> *</div><div class="line"> * @return 相应的变量值</div><div class="line"> */</div><div class="line">jobject (*GetObjectField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jboolean (*GetBooleanField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jbyte (*GetByteField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jchar (*GetCharField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jshort (*GetShortField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jint (*GetIntField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jlong (*GetLongField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jfloat (*GetFloatField)(JNIEnv *, jobject, jfieldID);</div><div class="line">jdouble (*GetDoubleField)(JNIEnv *, jobject, jfieldID);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据field id为相应的变量设置新的值，field Id通过GetFieldID()获取</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象</div><div class="line"> * @param fieldID 有效的field id</div><div class="line"> * @param value 要设置的值</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*SetObjectField)(JNIEnv *, jobject, jfieldID, jobject);</div><div class="line"><span class="keyword">void</span> (*SetBooleanField)(JNIEnv *, jobject, jfieldID, jboolean);</div><div class="line"><span class="keyword">void</span> (*SetByteField)(JNIEnv *, jobject, jfieldID, jbyte);</div><div class="line"><span class="keyword">void</span> (*SetCharField)(JNIEnv *, jobject, jfieldID, jchar);</div><div class="line"><span class="keyword">void</span> (*SetShortField)(JNIEnv *, jobject, jfieldID, jshort);</div><div class="line"><span class="keyword">void</span> (*SetIntField)(JNIEnv *, jobject, jfieldID, jint);</div><div class="line"><span class="keyword">void</span> (*SetLongField)(JNIEnv *, jobject, jfieldID, jlong);</div><div class="line"><span class="keyword">void</span> (*SetFloatField)(JNIEnv *, jobject, jfieldID, jfloat);</div><div class="line"><span class="keyword">void</span> (*SetDoubleField)(JNIEnv *, jobject, jfieldID, jdouble);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回静态方法的method ID</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param name 方法名</div><div class="line"> * @param sig 方法签名</div><div class="line"> *</div><div class="line"> * @return 方法ID or NULL</div><div class="line"> *</div><div class="line"> * @throws NoSuchMethodError 找不到对应的方法</div><div class="line"> * @throws ExceptionInInitializerError class初始化失败</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jmethodID (*GetStaticMethodID)(JNIEnv *, jclass, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * CallStatic&lt;type&gt;Method(JNIEnv *env, jclass clazz, jmethodID methodID, ...);调用参数放到可变参数中</div><div class="line"> * CallStatic&lt;type&gt;MethodA(JNIEnv *env, jclass clazz, jmethodID methodID, const jvalue *args);调用参数放入jvalue数组</div><div class="line"> * CallStatic&lt;type&gt;MethodV(JNIEnv *env, jclass clazz, jmethodID methodID, va_list args);调用参数放入va_list结构中</div><div class="line"> *</div><div class="line"> * 以上三组调用接口都是根据 method ID调用java静态方法的接口，其中method ID是通过GetStaticMethodID()获取的</div><div class="line"> * method ID必须从clazz的真实类获取，而不应从其某个父类获取</div><div class="line"> * &lt;type&gt;是方法的返回类型，三类接口间唯一的区别是methodID参数之后调用参数的不同</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param methodID 方法ID</div><div class="line"> * @param args 调用参数</div><div class="line"> *</div><div class="line"> * @return java方法返回结果</div><div class="line"> *</div><div class="line"> * @throws java方法中可能抛出的异常</div><div class="line"> */</div><div class="line">jobject (*CallStaticObjectMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jobject (*CallStaticObjectMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jobject (*CallStaticObjectMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jboolean (*CallStaticBooleanMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jboolean (*CallStaticBooleanMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jboolean (*CallStaticBooleanMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jbyte (*CallStaticByteMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jbyte (*CallStaticByteMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jbyte (*CallStaticByteMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jchar (*CallStaticCharMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jchar (*CallStaticCharMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jchar (*CallStaticCharMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jshort (*CallStaticShortMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jshort (*CallStaticShortMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jshort (*CallStaticShortMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jint (*CallStaticIntMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jint (*CallStaticIntMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jint (*CallStaticIntMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jlong (*CallStaticLongMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jlong (*CallStaticLongMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jlong (*CallStaticLongMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jfloat (*CallStaticFloatMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jfloat (*CallStaticFloatMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jfloat (*CallStaticFloatMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line">jdouble (*CallStaticDoubleMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line">jdouble (*CallStaticDoubleMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line">jdouble (*CallStaticDoubleMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line"><span class="keyword">void</span> (*CallStaticVoidMethod)(JNIEnv *, jclass, jmethodID, ...);</div><div class="line"><span class="keyword">void</span> (*CallStaticVoidMethodV)(JNIEnv *, jclass, jmethodID, va_list);</div><div class="line"><span class="keyword">void</span> (*CallStaticVoidMethodA)(JNIEnv *, jclass, jmethodID, jvalue *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据class对象获取静态成员变量的field ID</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param name 变量名</div><div class="line"> * @param sig 变量签名</div><div class="line"> *</div><div class="line"> * @return field ID or NULL</div><div class="line"> *</div><div class="line"> * @throws NoSuchFieldError 找不到对应的变量ID</div><div class="line"> * @throws ExceptionInInitializerError class初始化失败</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jfieldID (*GetStaticFieldID)(JNIEnv *, jclass, <span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据field id取出对象中相应的变量值，field Id通过GetStaticFieldID()获取</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param fieldID 有效的field id</div><div class="line"> *</div><div class="line"> * @return 相应的静态变量值</div><div class="line"> */</div><div class="line">jobject (*GetStaticObjectField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jboolean (*GetStaticBooleanField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jbyte (*GetStaticByteField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jchar (*GetStaticCharField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jshort (*GetStaticShortField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jint (*GetStaticIntField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jlong (*GetStaticLongField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jfloat (*GetStaticFloatField)(JNIEnv *, jclass, jfieldID);</div><div class="line">jdouble (*GetStaticDoubleField)(JNIEnv *, jclass, jfieldID);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据field id为相应的静态变量设置新的值，field Id通过GetStaticFieldID()获取</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param fieldID 有效的field id</div><div class="line"> * @param value 要设置的值</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*SetStaticObjectField)(JNIEnv *, jclass, jfieldID, jobject);</div><div class="line"><span class="keyword">void</span> (*SetStaticBooleanField)(JNIEnv *, jclass, jfieldID, jboolean);</div><div class="line"><span class="keyword">void</span> (*SetStaticByteField)(JNIEnv *, jclass, jfieldID, jbyte);</div><div class="line"><span class="keyword">void</span> (*SetStaticCharField)(JNIEnv *, jclass, jfieldID, jchar);</div><div class="line"><span class="keyword">void</span> (*SetStaticShortField)(JNIEnv *, jclass, jfieldID, jshort);</div><div class="line"><span class="keyword">void</span> (*SetStaticIntField)(JNIEnv *, jclass, jfieldID, jint);</div><div class="line"><span class="keyword">void</span> (*SetStaticLongField)(JNIEnv *, jclass, jfieldID, jlong);</div><div class="line"><span class="keyword">void</span> (*SetStaticFloatField)(JNIEnv *, jclass, jfieldID, jfloat);</div><div class="line"><span class="keyword">void</span> (*SetStaticDoubleField)(JNIEnv *, jclass, jfieldID, jdouble);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 创建一个新的java.lang.String对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param unicodeChars 指向Unicode字符串的指针</div><div class="line"> * @param len Unicode字符串的长度</div><div class="line"> *</div><div class="line"> * @return String对象 or NULL</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jstring (*NewString)(JNIEnv *, <span class="keyword">const</span> jchar *, jsize);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回java.lang.String的长度（Unicode字符数）</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> *</div><div class="line"> * @return 长度</div><div class="line"> */</div><div class="line">jsize (*GetStringLength)(JNIEnv *, jstring);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回指向Unicode字符数组的指针</div><div class="line"> * 该指针在调用ReleaseStringchars()前一直有效</div><div class="line"> * 如果isCopy非空，则在复制完成后将*isCopy设为JNI_TRUE。否则设为JNI_FALSE</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> * @param isCopy 指向boolean的指针</div><div class="line"> *</div><div class="line"> * @return 指向字符串的指针 or NULL</div><div class="line"> */</div><div class="line"><span class="keyword">const</span> jchar *(*GetStringChars)(JNIEnv *, jstring, jboolean *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 通知VM无需再访问chars</div><div class="line"> * chars是一个指针，通过GetStringChars()</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> * @param chars 指向字符串的指针</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*ReleaseStringChars)(JNIEnv *, jstring, <span class="keyword">const</span> jchar *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据UTF-8编码的字符数组创建一个新的java.lang.String对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param bytes 指向UTF-8字符串的指针</div><div class="line"> *</div><div class="line"> * @return String对象 or NULL</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError 内存不足</div><div class="line"> */</div><div class="line">jstring (*NewStringUTF)(JNIEnv *, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回字符串以UTF-8为编码的字节数</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> *</div><div class="line"> * @return 字符串的UTF-8字节数</div><div class="line"> */</div><div class="line">jsize (*GetStringUTFLength)(JNIEnv *, jstring);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回指向UTF-8编码字符数组的指针</div><div class="line"> * 该指针在调用ReleaseStringUTFChars()前一直有效</div><div class="line"> * 如果isCopy非空，则在复制完成后将*isCopy设为JNI_TRUE。否则设为JNI_FALSE</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> * @param isCopy 指向boolean的指针</div><div class="line"> *</div><div class="line"> * @return 指向字符串的指针 or NULL</div><div class="line"> */</div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> *(*GetStringUTFChars)(JNIEnv *, jstring, jboolean *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 通知VM无需再访问utf</div><div class="line"> * utf是一个指针，通过GetStringUTFChars()</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> * @param utf 指向字符串的指针</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*ReleaseStringUTFChars)(JNIEnv *, jstring, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 获取数组元素个数</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组对象</div><div class="line"> *</div><div class="line"> * @return 数组长度</div><div class="line"> */</div><div class="line">jsize (*GetArrayLength)(JNIEnv *, jarray);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 创建新的elementClass类型数组，所有元素初始值均设为initialElement</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param length 数组大小</div><div class="line"> * @param elementClass 数组类型</div><div class="line"> * @param initialElement 初始值</div><div class="line"> *</div><div class="line"> * @return 数组对象 or NULL</div><div class="line"> */</div><div class="line">jobjectArray (*NewObjectArray)(JNIEnv *, jsize, jclass, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 获取对象数组中指定index的值</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组</div><div class="line"> * @param index 索引</div><div class="line"> *</div><div class="line"> * @return 索引对象的对象</div><div class="line"> *</div><div class="line"> * @throws ArrayIndexOutOfBoundsException</div><div class="line"> */</div><div class="line">jobject (*GetObjectArrayElement)(JNIEnv *, jobjectArray, jsize);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 设置对象数组中指定index的值</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组</div><div class="line"> * @param index 索引</div><div class="line"> * @param value 新的值</div><div class="line"> *</div><div class="line"> * @throws ArrayIndexOutOfBoundsException</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*SetObjectArrayElement)(JNIEnv *, jobjectArray, jsize, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * ArrayType New&lt;PrimitiveType&gt;Array(JNIEnv *env, jsize length);</div><div class="line"> * 创建基本类型数组对象</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param length 数组大小</div><div class="line"> *</div><div class="line"> * @return 数组对象 or NULL</div><div class="line"> */</div><div class="line">jbooleanArray (*NewBooleanArray)(JNIEnv *, jsize);</div><div class="line">jbyteArray (*NewByteArray)(JNIEnv *, jsize);</div><div class="line">jcharArray (*NewCharArray)(JNIEnv *, jsize);</div><div class="line">jshortArray (*NewShortArray)(JNIEnv *, jsize);</div><div class="line">jintArray (*NewIntArray)(JNIEnv *, jsize);</div><div class="line">jlongArray (*NewLongArray)(JNIEnv *, jsize);</div><div class="line">jfloatArray (*NewFloatArray)(JNIEnv *, jsize);</div><div class="line">jdoubleArray (*NewDoubleArray)(JNIEnv *, jsize);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * NativeType *Get&lt;PrimitiveType&gt;ArrayElements(JNIEnv *env, ArrayType array, jboolean *isCopy);</div><div class="line"> * 返回基本类型数组中的数据，通过返回的指针可以访问这些数据，若虚拟机支持pinning，则指针指向原始数组，否则指向原始数组的拷贝</div><div class="line"> * 返回的指针在Release&lt;PrimitiveType&gt;ArrayElements()调用前一直有效</div><div class="line"> * 数组用使用结束后，调用Release&lt;PrimitiveType&gt;ArrayElements，并在调用参数中决定是否把修改提交给java</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组</div><div class="line"> * @param isCopy 指向boolean的指针，若不为NULL，则执行了复制设为JNI_TRUE，否则设为JNI_FALSE</div><div class="line"> *</div><div class="line"> * @return 指向数组元素的指针 or NULL</div><div class="line"> */</div><div class="line">jboolean *(*GetBooleanArrayElements)(JNIEnv *, jbooleanArray, jboolean *);</div><div class="line">jbyte *(*GetByteArrayElements)(JNIEnv *, jbyteArray, jboolean *);</div><div class="line">jchar *(*GetCharArrayElements)(JNIEnv *, jcharArray, jboolean *);</div><div class="line">jshort *(*GetShortArrayElements)(JNIEnv *, jshortArray, jboolean *);</div><div class="line">jint *(*GetIntArrayElements)(JNIEnv *, jintArray, jboolean *);</div><div class="line">jlong *(*GetLongArrayElements)(JNIEnv *, jlongArray, jboolean *);</div><div class="line">jfloat *(*GetFloatArrayElements)(JNIEnv *, jfloatArray, jboolean *);</div><div class="line">jdouble *(*GetDoubleArrayElements)(JNIEnv *, jdoubleArray, jboolean *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Release&lt;PrimitiveType&gt;ArrayElements</div><div class="line"> * 通知VM不再需要访问这些数组，根据mode参数的不同，将决定是否把数组的修改复制到源数组</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组对象</div><div class="line"> * @param elems 指向数组元素的指针</div><div class="line"> * @param mode 释放模式，0：把数据复制回源数组并释放elems缓冲区，JNI_COMMIT：把数据复制回源数组但不释放elems缓冲区，JNI_ABORT：不把数据复制回源数组，释放elems缓冲区</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*ReleaseBooleanArrayElements)(JNIEnv *, jbooleanArray, jboolean *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseByteArrayElements)(JNIEnv *, jbyteArray, jbyte *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseCharArrayElements)(JNIEnv *, jcharArray, jchar *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseShortArrayElements)(JNIEnv *, jshortArray, jshort *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseIntArrayElements)(JNIEnv *, jintArray, jint *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseLongArrayElements)(JNIEnv *, jlongArray, jlong *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseFloatArrayElements)(JNIEnv *, jfloatArray, jfloat *, jint);</div><div class="line"><span class="keyword">void</span> (*ReleaseDoubleArrayElements)(JNIEnv *, jdoubleArray, jdouble *, jint);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * void Get&lt;PrimitiveType&gt;ArrayRegion(JNIEnv *env, ArrayType array, jsize start, jsize len, NativeType *buf);</div><div class="line"> * 把基本类型数组拷贝到buf中</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组</div><div class="line"> * @param start 开始index</div><div class="line"> * @param len 拷贝长度</div><div class="line"> * @param buf 目标地址</div><div class="line"> *</div><div class="line"> * @throws ArrayIndexOutOfBoundsException</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*GetBooleanArrayRegion)(JNIEnv *, jbooleanArray, jsize, jsize, jboolean *);</div><div class="line"><span class="keyword">void</span> (*GetByteArrayRegion)(JNIEnv *, jbyteArray, jsize, jsize, jbyte *);</div><div class="line"><span class="keyword">void</span> (*GetCharArrayRegion)(JNIEnv *, jcharArray, jsize, jsize, jchar *);</div><div class="line"><span class="keyword">void</span> (*GetShortArrayRegion)(JNIEnv *, jshortArray, jsize, jsize, jshort *);</div><div class="line"><span class="keyword">void</span> (*GetIntArrayRegion)(JNIEnv *, jintArray, jsize, jsize, jint *);</div><div class="line"><span class="keyword">void</span> (*GetLongArrayRegion)(JNIEnv *, jlongArray, jsize, jsize, jlong *);</div><div class="line"><span class="keyword">void</span> (*GetFloatArrayRegion)(JNIEnv *, jfloatArray, jsize, jsize, jfloat *);</div><div class="line"><span class="keyword">void</span> (*GetDoubleArrayRegion)(JNIEnv *, jdoubleArray, jsize, jsize, jdouble *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * void Set&lt;PrimitiveType&gt;ArrayRegion(JNIEnv *env, ArrayType array, jsize start, jsize len, const NativeType *buf);</div><div class="line"> * 把buf中的内容拷贝回数组中</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组</div><div class="line"> * @param start 开始index</div><div class="line"> * @param len 拷贝长度</div><div class="line"> * @param buf 源数据</div><div class="line"> *</div><div class="line"> * @throws ArrayIndexOutOfBoundsException</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*SetBooleanArrayRegion)(JNIEnv *, jbooleanArray, jsize, jsize, <span class="keyword">const</span> jboolean *);</div><div class="line"><span class="keyword">void</span> (*SetByteArrayRegion)(JNIEnv *, jbyteArray, jsize, jsize, <span class="keyword">const</span> jbyte *);</div><div class="line"><span class="keyword">void</span> (*SetCharArrayRegion)(JNIEnv *, jcharArray, jsize, jsize, <span class="keyword">const</span> jchar *);</div><div class="line"><span class="keyword">void</span> (*SetShortArrayRegion)(JNIEnv *, jshortArray, jsize, jsize, <span class="keyword">const</span> jshort *);</div><div class="line"><span class="keyword">void</span> (*SetIntArrayRegion)(JNIEnv *, jintArray, jsize, jsize, <span class="keyword">const</span> jint *);</div><div class="line"><span class="keyword">void</span> (*SetLongArrayRegion)(JNIEnv *, jlongArray, jsize, jsize, <span class="keyword">const</span> jlong *);</div><div class="line"><span class="keyword">void</span> (*SetFloatArrayRegion)(JNIEnv *, jfloatArray, jsize, jsize, <span class="keyword">const</span> jfloat *);</div><div class="line"><span class="keyword">void</span> (*SetDoubleArrayRegion)(JNIEnv *, jdoubleArray, jsize, jsize, <span class="keyword">const</span> jdouble *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 为clazz类注册本地方法</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> * @param methods clazz类中的本地方法，指向方法数组</div><div class="line"> * @param nMethods 本地方法个数</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> *</div><div class="line"> * @throws NoSuchMethodError</div><div class="line"> */</div><div class="line">jint (*RegisterNatives)(JNIEnv *, jclass, <span class="keyword">const</span> JNINativeMethod *, jint);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 取消clazz类本地方法的注册</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param clazz class对象</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> */</div><div class="line">jint (*UnregisterNatives)(JNIEnv *, jclass);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 进入与obj所引用的Java对象相关联的监控，obj 必须为非空</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象 或 class对象</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> */</div><div class="line">jint (*MonitorEnter)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 退出与obj所引用的Java对象相关联的监控，obj 必须为非空</div><div class="line"> * 当前线程必须是与obj所引用的Java对象相关联的监控程序的所有者</div><div class="line"> * 监控程序次数的计数器减 1。如果计数器的值变为 0，则释放当前线程的监控程序</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象 或 class对象</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> */</div><div class="line">jint (*MonitorExit)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 获取当前线程关联的Java VM接口</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param vm java VM接口指针</div><div class="line"> *</div><div class="line"> * @return 0：成功， 负数：失败</div><div class="line"> */</div><div class="line">jint (*GetJavaVM)(JNIEnv *, JavaVM **);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 从start index开始，拷贝len个Unicode字符到buf</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param str string对象</div><div class="line"> * @param start 开始index</div><div class="line"> * @param len 拷贝长度</div><div class="line"> * @param buf 目标地址</div><div class="line"> *</div><div class="line"> * @throws StringIndexOutOfBoundsException</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*GetStringRegion)(JNIEnv *, jstring, jsize, jsize, jchar *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 从start index开始，取出len个Unicode字符转换为UTF-8编码后拷贝到buf</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param str string对象</div><div class="line"> * @param start 开始index</div><div class="line"> * @param len 拷贝长度</div><div class="line"> * @param buf 目标地址</div><div class="line"> *</div><div class="line"> * @throws StringIndexOutOfBoundsException</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*GetStringUTFRegion)(JNIEnv *, jstring, jsize, jsize, <span class="keyword">char</span> *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 与Get/Release&lt;primitivetype&gt;ArrayElements方法非常相似，在这个方法中VM尽量返回指向原始数组的指针</div><div class="line"> *</div><div class="line"> * @since JDK/JRE 1.2</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param array java数组</div><div class="line"> * @param isCopy 指向boolean的指针，若不为NULL，则执行了复制设为JNI_TRUE，否则设为JNI_FALSE</div><div class="line"> *</div><div class="line"> * @return 指向数组元素的指针 or NULL</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> *(*GetPrimitiveArrayCritical)(JNIEnv *, jarray, jboolean *);</div><div class="line"><span class="keyword">void</span> (*ReleasePrimitiveArrayCritical)(JNIEnv *, jarray, <span class="keyword">void</span> *, jint);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 与Get/ReleaseStringChars方法非常相似，在这个方法中VM尽量返回指向原始字符串的指针</div><div class="line"> *</div><div class="line"> * @since JDK/JRE 1.2</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param string String对象</div><div class="line"> * @param isCopy 指向boolean的指针</div><div class="line"> *</div><div class="line"> * @return 指向字符串的指针 or NULL</div><div class="line"> */</div><div class="line"><span class="keyword">const</span> jchar *(*GetStringCritical)(JNIEnv *, jstring, jboolean *);</div><div class="line"><span class="keyword">void</span> (*ReleaseStringCritical)(JNIEnv *, jstring, <span class="keyword">const</span> jchar *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 为传入的obj创建弱全局引用</div><div class="line"> * 弱全局引用不会阻止VM释放所引用的对象，程序中可以通过使用IsSameObject比较弱全局引用和NULL来确认所引用的对象是否被释放</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj 全局或局部引用</div><div class="line"> *</div><div class="line"> * @return 弱全局引用 or NULL</div><div class="line"> */</div><div class="line">jweak (*NewWeakGlobalRef)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 删除弱全局引用</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj 弱全局引用</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> (*DeleteWeakGlobalRef)(JNIEnv *, jweak);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 判断是否有未处理异常</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> *</div><div class="line"> * @return JNI_TRUE表示有未处理异常，否则为JNI_FALSE</div><div class="line"> */</div><div class="line">jboolean (*ExceptionCheck)(JNIEnv *);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 创建并返回java.nio.ByteBuffer对象，该对象引用以address为开始地址，大小为capacity的内存块</div><div class="line"> *</div><div class="line"> * @since JDK/JRE 1.4</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param address 开始地址</div><div class="line"> * @param capacity 内存大小</div><div class="line"> *</div><div class="line"> * @return Jjava.nio.ByteBuffer or NULL</div><div class="line"> *</div><div class="line"> * @throws OutOfMemoryError</div><div class="line"> */</div><div class="line">jobject (*NewDirectByteBuffer)(JNIEnv *, <span class="keyword">void</span> *, jlong);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据java.nio.ByteBuffer对象，获取相应的内存数据并返回开始地址</div><div class="line"> *</div><div class="line"> * @since JDK/JRE 1.4</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param buf java.nio.ByteBuffer对象</div><div class="line"> *</div><div class="line"> * @return 数据的开始地址 or NULL</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> *(*GetDirectBufferAddress)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 根据java.nio.ByteBuffer对象，获取相应的内存数据的大小</div><div class="line"> *</div><div class="line"> * @since JDK/JRE 1.4</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param buf java.nio.ByteBuffer对象</div><div class="line"> *</div><div class="line"> * @return 数据大小 or -1</div><div class="line"> */</div><div class="line">jlong (*GetDirectBufferCapacity)(JNIEnv *, jobject);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 获取java对象的引用类型，可能的返回值有：</div><div class="line"> * JNIInvalidRefType</div><div class="line"> * JNILocalRefType：局部引用</div><div class="line"> * JNIGlobalRefType：全局引用</div><div class="line"> * JNIWeakGlobalRefType ：全局弱若引用</div><div class="line"> *</div><div class="line"> * @since JDK/JRE 1.6</div><div class="line"> *</div><div class="line"> * @param env JNI接口指针</div><div class="line"> * @param obj java对象的引用</div><div class="line"> *</div><div class="line"> * @return 引用类型</div><div class="line"> */</div><div class="line">jobjectRefType (*GetObjectRefType)(JNIEnv *, jobject);</div></pre></td></tr></table></figure></p>
<h3 id="简单案例"><a href="#简单案例" class="headerlink" title="简单案例"></a>简单案例</h3><p>一般用的最多的就是Java调用C的实现, 下面给出了一个非常简单的例子:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT jintArray JNICALL <span class="title">Java_com_example_Test_intMethod</span></span></div><div class="line"><span class="params">(JNIENV *env, jobject jobject, jintArray jarray)</span> &#123;</div><div class="line">  <span class="comment">//遍历数组元素, 每个元素+5; 最后返回原数组</span></div><div class="line">  <span class="keyword">int</span> length = (*env)-&gt;GetArrayLength(env, jarray);</div><div class="line">  <span class="keyword">int</span> *<span class="built_in">array</span> = (*env)-&gt;GetINtArrayElements(env,jarray,<span class="number">0</span>);</div><div class="line"></div><div class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; length; ++i) &#123;</div><div class="line">      *(<span class="built_in">array</span>+i) += <span class="number">5</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> jarray;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="尾巴"><a href="#尾巴" class="headerlink" title="尾巴"></a>尾巴</h1><p>jni本身还是比较简单的, 因为机制比较成熟了. 基本的规则, 本文已经讲了非常多了, 关键还是要熟悉 jni.h 这个文件里的相关API.</p>
<p>先这样, 以后用到了再来详细搞.</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a href="">《the JNI Programmer’s Guide and Specification》</a>  主要参考资料, 把这本好好读读就可以了</li>
<li><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jni/" target="_blank" rel="external">http://docs.oracle.com/javase/7/docs/technotes/guides/jni/</a> 主要参考资料</li>
<li><a href="">JNI编程指南</a>  网上找的比较偏理论的讲解,80多页</li>
<li><a href="http://blog.csdn.net/shensky711/article/details/52806794" target="_blank" rel="external">http://blog.csdn.net/shensky711/article/details/52806794</a>  作者写的太乱了</li>
</ol>
<hr>
<p>who is sponsoring the site? - i shall say merlin (<code>wizardmerlin945@gmail.com</code>)<br>欢迎发邮件给我(生活问题，请高抬贵手)</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2017/08/22/thrift.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2017/08/22/rapid-json.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-08-22 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/codings/">codings<span>62</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/cpp/">cpp<span>21</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#引子"><span class="toc-article-text">引子</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#正文"><span class="toc-article-text">正文</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#开发流程"><span class="toc-article-text">开发流程</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Java主调C代码"><span class="toc-article-text">Java主调C代码.</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#C主调Java代码"><span class="toc-article-text">C主调Java代码</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#本地方法规范"><span class="toc-article-text">本地方法规范</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#命名符号解析"><span class="toc-article-text">命名符号解析</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#类型符号解析"><span class="toc-article-text">类型符号解析</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#参数解析"><span class="toc-article-text">参数解析</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#对象类型解析"><span class="toc-article-text">对象类型解析</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#类型别名解析"><span class="toc-article-text">类型别名解析</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#调用Java方法"><span class="toc-article-text">调用Java方法</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#方法签名"><span class="toc-article-text">方法签名</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#异常处理"><span class="toc-article-text">异常处理</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Java部分处理"><span class="toc-article-text">Java部分处理:</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#本地部分处理"><span class="toc-article-text">本地部分处理</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#JNI接口详解"><span class="toc-article-text">JNI接口详解</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#返回码说明"><span class="toc-article-text">返回码说明</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#接口代码说明"><span class="toc-article-text">接口代码说明</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#简单案例"><span class="toc-article-text">简单案例</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#尾巴"><span class="toc-article-text">尾巴</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#参考资料"><span class="toc-article-text">参考资料</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2017 MerlinYu
  
     
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
