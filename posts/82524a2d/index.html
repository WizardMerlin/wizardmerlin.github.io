<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Merlin" />



<meta name="description" content="作品页面的配套讲解页，主要讲解 Qt 网络编程核心代码。">
<meta name="keywords" content="cpp,qt,udp,tcp,粘包,http">
<meta property="og:type" content="article">
<meta property="og:title" content="技术: Qt 网络编程案例汇总">
<meta property="og:url" content="http://www.merlinblog.site/posts/82524a2d/index.html">
<meta property="og:site_name" content="梅林日志">
<meta property="og:description" content="作品页面的配套讲解页，主要讲解 Qt 网络编程核心代码。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-25-network_access.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple1.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple3.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple2.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple4.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple5.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file1.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file2.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file3.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file4.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file5.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file5-1.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file6.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_tmp.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_byte1.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_byte2.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_byte3.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-01-qt_85.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple1.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple2.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple3.jpg">
<meta property="og:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple4.jpg">
<meta property="og:updated_time" content="2018-04-12T06:55:17.627Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="技术: Qt 网络编程案例汇总">
<meta name="twitter:description" content="作品页面的配套讲解页，主要讲解 Qt 网络编程核心代码。">
<meta name="twitter:image" content="http://omotkhw3y.bkt.clouddn.com/2018-01-25-network_access.jpg">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="梅林日志" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.gif">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/red/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>技术: Qt 网络编程案例汇总 | 梅林日志</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/mine.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Merlin</a></h1>
        </hgroup>

        
        <p class="header-subtitle">云卷云舒，平常心态</p>
        

        


        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">[归档]</a></li>
                        
                            <li><a href="/works/">小作品</a></li>
                        
                            <li><a href="/tags/">[标签]</a></li>
                        
                            <li><a href="/about/">关于</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" href="https://github.com/WizardMerlin" title="GitHub"></a>
                            
                                <a class="fa 豆瓣" href="https://www.douban.com/people/170414854/" title="豆瓣"></a>
                            
                                <a class="fa Email" href="mailto:&#119;&#105;&#122;&#97;&#114;&#100;&#109;&#101;&#114;&#108;&#105;&#110;&#57;&#52;&#53;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;" title="Email"></a>
                            
                                <a class="fa QQ" href="tencent://message/?Menu=yes&uin=3076407405" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">极简.</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Merlin</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/mine.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Merlin</a></h1>
            </hgroup>
            
            <p class="header-subtitle">云卷云舒，平常心态</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">[归档]</a></li>
                
                    <li><a href="/works/">小作品</a></li>
                
                    <li><a href="/tags/">[标签]</a></li>
                
                    <li><a href="/about/">关于</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/WizardMerlin" title="GitHub"></a>
                            
                                <a class="fa 豆瓣" target="_blank" href="https://www.douban.com/people/170414854/" title="豆瓣"></a>
                            
                                <a class="fa Email" target="_blank" href="mailto:&#119;&#105;&#122;&#97;&#114;&#100;&#109;&#101;&#114;&#108;&#105;&#110;&#57;&#52;&#53;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;" title="Email"></a>
                            
                                <a class="fa QQ" target="_blank" href="tencent://message/?Menu=yes&uin=3076407405" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-qt_network_case_all" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/82524a2d/" class="article-date">
      <time datetime="2017-02-28T11:36:02.000Z" itemprop="datePublished">2017-02-28</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      技术: Qt 网络编程案例汇总
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cpp/">cpp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/">http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qt/">qt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcp/">tcp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/udp/">udp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/粘包/">粘包</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>作品页面的配套讲解页，主要讲解 Qt 网络编程核心代码。</p>
<a id="more"></a>
<p>除了第二个阻塞的案例外，基本上新手一看就能懂。<br>具备网络基础的话，相当于仅仅是熟悉 Qt 网络编程的API。</p>
<h2 id="访问网络-简单"><a href="#访问网络-简单" class="headerlink" title="访问网络(简单)"></a>访问网络(简单)</h2><p>这里要完成一个简单的事情，访问网络，然后拿到服务器返回的 HTML 代码。</p>
<p>当然获取网页代码(或者显示HTML代码)并不是真正诉求，重点在于 Qt网络编程中，如何利用<strong>QNetworkAccessManager</strong>发出<strong>QNetworkRequest</strong>请求，然后处理收到的<strong>QNetworkReply</strong>响应。以及如何封装网络访问代码，至少是和业务接口解耦。（让业务接口可以直接调用这边儿的接口，而且做到二进制兼容，即连接库，或者远端API修改时，不用修改源码，也不用重新编译）</p>
<p>封装一下网络访问的工具类:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*networker.h*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> NETWORKER_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NETWORKER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QNetworkAccessManager&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QNetworkReply&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QNetworkRequest&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QNetworkReply</span>;</span></span><br><span class="line"><span class="comment">//class NetWorker::Private;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetWorker</span> :</span> <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/*接口主要给内部类Private使用, 外部也可以用*/</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> NetWorker *<span class="title">getInstance</span><span class="params">()</span></span>;</span><br><span class="line">    ~NetWorker();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get</span><span class="params">(<span class="keyword">const</span> QString &amp;url)</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">finished</span><span class="params">(QNetworkReply *reply)</span></span>;<span class="comment">//网络请求完成的信号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Private</span>;</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">Private</span>;</span></span><br><span class="line">    Private *d;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//私有化三大元</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">NetWorker</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    NetWorker(<span class="keyword">const</span> NetWorker &amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    NetWorker&amp; <span class="keyword">operator</span>=(NetWorker worker) =<span class="keyword">delete</span>;<span class="comment">//Q_DECL_EQ_DELETE;</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetWorker</span>:</span>:Private</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/*给 Private 构造器传入 NetWorker 主要是因为</span></span><br><span class="line"><span class="comment">     * QNetworkAccessManager需要一个 QObject 父类，用来实现自动回收</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    Private(NetWorker *q) :</span><br><span class="line">        manager(<span class="keyword">new</span> QNetworkAccessManager(q))</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*不必写析构器，因为已经给内部维护的manager指针指定了父类QObject对象了*/</span></span><br><span class="line"></span><br><span class="line">    QNetworkAccessManager *manager;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// NETWORKER_H</span></span></span><br></pre></td></tr></table></figure>
<p>具体实现代码:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*networker.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"networker.h"</span></span></span><br><span class="line"></span><br><span class="line">NetWorker::NetWorker(QObject *parent) : QObject(parent),</span><br><span class="line">    d(<span class="keyword">new</span> NetWorker::Private(<span class="keyword">this</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*直接把 QNetworkAccessManager 的信号转发到 本类*/</span></span><br><span class="line">    connect(d-&gt;manager, &amp;QNetworkAccessManager::finished,</span><br><span class="line">            <span class="keyword">this</span>, &amp;NetWorker::finished);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Private 类实例是本类构造器new的，所以本类负责销毁*/</span></span><br><span class="line">NetWorker::~NetWorker()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> d;</span><br><span class="line">    d = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*返回单例*/</span></span><br><span class="line">NetWorker *NetWorker::getInstance()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> NetWorker netWorker; <span class="comment">//这里不用指定 parent 参数</span></span><br><span class="line">    <span class="keyword">return</span> &amp;netWorker;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*请求方法也是简单封装即可*/</span></span><br><span class="line"><span class="keyword">void</span> NetWorker::get(<span class="keyword">const</span> QString &amp;url)</span><br><span class="line">&#123;</span><br><span class="line">    d-&gt;manager-&gt;get(QNetworkRequest(QUrl(url)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用代码:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::MainWindow(QWidget *parent)</span><br><span class="line">    : QMainWindow(parent)</span><br><span class="line">&#123;</span><br><span class="line">    networker = NetWorker::getInstance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*绑定networker finshed信号*/</span></span><br><span class="line">    connect(networker, &amp;NetWorker::finished, [=](QNetworkReply *reply)&#123;</span><br><span class="line">        <span class="comment">//从解析到的 reply中拿到数据,封装到pojo中&amp;domain class中(略)</span></span><br><span class="line">        qDebug() &lt;&lt; reply-&gt;readAll().data(); <span class="comment">//这里读了一大堆乱七八糟的 HTML 代码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*删除 reply*/</span></span><br><span class="line">        reply-&gt;deleteLater();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*发送网络请求*/</span></span><br><span class="line">    networker-&gt;get(QString(<span class="string">"http://www.baidu.com/"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>运行结果符合预期</strong>:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-25-network_access.jpg" alt=" "></p>
<p>总结一下，如果不带封装，核心代码不过如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QNetworkReply *replay;</span><br><span class="line">QNetworkAccessManager *mgr = <span class="keyword">new</span> QNetworkAccessManager();</span><br><span class="line"></span><br><span class="line">mgr-&gt;setNetworkAccessible(QNetworkAccessManager::Accessible);</span><br><span class="line">replay = mgr-&gt;get(QNetworkRequest(QUrl(url)));</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示响应信息</span></span><br><span class="line">replay-&gt;readAll();</span><br></pre></td></tr></table></figure>
<p>或者需要验证的时候，大致是这样的:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">QNetworkAccessManager *manager = <span class="keyword">new</span> QNetworkAccessManager(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">connect(manager, SIGNAL(proxyAuthenticationRequired(<span class="keyword">const</span> QNetworkProxy &amp;, QAuthenticator *)),</span><br><span class="line">  SLOT(slotProxyAuthenticationRequired(<span class="keyword">const</span> QNetworkProxy &amp;, QAuthenticator *)));</span><br><span class="line">connect(manager, SIGNAL(authenticationRequired(QNetworkReply *, QAuthenticator *)),</span><br><span class="line">  SLOT(slotAuthenticationRequired(QNetworkReply *, QAuthenticator *)));</span><br><span class="line"></span><br><span class="line">QNetworkRequest request;</span><br><span class="line"></span><br><span class="line">request.setUrl(m_url);</span><br><span class="line">request.setRawHeader(<span class="string">"User-Agent"</span>, <span class="string">"Qt NetworkAccess 1.3"</span>);</span><br><span class="line"></span><br><span class="line">m_pReply = manager-&gt;get(request);</span><br></pre></td></tr></table></figure>
<p>在发送请求之后 get()，我们进入事件循环并等待finished()来自网络访问管理器的信号。当到达时，请求已经完成 - 成功或失败。接下来，我们应该打电话 reply-&gt;error()来查看是否有问题并报告，或者如果一切顺利，请拨打电话reply-&gt;readAll()或相似的地方获取我们的数据。</p>
<p>注意在 .pro 文件中添加 <code>DEFINES  += QT_NO_SSL</code>.</p>
<h2 id="同步阻塞下载文件-范例"><a href="#同步阻塞下载文件-范例" class="headerlink" title="同步阻塞下载文件(范例)"></a>同步阻塞下载文件(范例)</h2><blockquote>
<p>“How can I use QNetworkManager for synchronous downloads?”. Several times, the first hint is “Use it in asynchronous mode.” This tends to make me angry, not only because the reply is useless. It also sounds to me like “Don’t you know how to use it asynchronously, stupid?”.</p>
</blockquote>
<p>异步回调下载可能引发的问题:</p>
<ul>
<li>该文件将在下载之前完全下载到内存中finished()。对于大文件，这可能需要一段时间，甚至填满所有内存（导致您的应用程序崩溃）。</li>
<li>使用一个不同的信号，如响应对象提前触发readyRead()，QNetworkRequest将会留下一个大文件的第一部分，但是你无法得到其余的部分。</li>
<li>下载时无法向用户显示进度。</li>
<li>流不能被这样处理，就像finish()永远不会被调用 - 应用程序将锁定，最终耗尽内存和崩溃。</li>
<li>在非 GUI 线程中使用此代码 QEventLoop 时，可能导致死锁。</li>
</ul>
<p>一般的解决方案是:</p>
<ul>
<li>使用一个QThread来处理传入的数据。</li>
<li>根据运行在GUI还是非GUI模式，使用不同的方法进行线程同步。</li>
<li>对于GUI线程，使用QEventLoop确保我们正在维护一个活泼的用户界面。</li>
</ul>
<p>但是如果工作线程处理数据不够快，内存还是容易填满；并且线程还有一个缺陷，<code>QTimers must be created from QThread</code>, 也就是说定时器是跟实际工作的线程有关。</p>
<hr>
<p>下面是实际解决方案(提供一种解决思路):</p>
<p>首先，我们需要创建并开始QThread处理传入的数据，同时保持用户界面的快乐和活跃：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">webfile::webfile(QObject *parent <span class="comment">/*= 0*/</span>) :</span><br><span class="line">    QObject(parent),</span><br><span class="line">    m_pNetworkProxy(<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// QThread is required, otherwise QEventLoop will block</span></span><br><span class="line">    m_pSocketThread = <span class="keyword">new</span> QThread(<span class="keyword">this</span>);</span><br><span class="line">    moveToThread(m_pSocketThread);</span><br><span class="line">    m_pSocketThread-&gt;start(QThread::HighestPriority);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在打开和读取操作中，线程将被使用。请注意，我们必须检查我们是否以 GUI 线程运行，并采取不同的行动。调用 exec() 函数 QEventLoop 可能导致在非GUI线程中发生死锁 - QNetworkRequest 由此发送的信号将不被接受，所以 quit() 插槽将永远不会被激活。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*注意这个方法带有 event loop, 所以在不同线程调用时，采用不同的方法*/</span></span><br><span class="line"><span class="keyword">void</span> webfile::slotOpen(<span class="keyword">void</span> *pReturnSuccess, <span class="keyword">void</span> *pLoop, qint64 offset <span class="comment">/*= 0*/</span>)</span><br><span class="line">&#123;</span><br><span class="line">    *(<span class="keyword">bool</span>*)pReturnSuccess = workerOpen(offset);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pLoop != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        QMetaObject::invokeMethod((QEventLoop*)pLoop, <span class="string">"quit"</span>, Qt::QueuedConnection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> webfile::open(qint64 offset <span class="comment">/*= 0*/</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">bool</span> bSuccess = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isGuiThread())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// For GUI threads, we use the non-blocking call and use QEventLoop to wait and yet keep the GUI alive</span></span><br><span class="line">        QMetaObject::invokeMethod(<span class="keyword">this</span>, <span class="string">"slotOpen"</span>, Qt::QueuedConnection,</span><br><span class="line">                                  Q_ARG(<span class="keyword">void</span> *, &amp;bSuccess),</span><br><span class="line">                                  Q_ARG(<span class="keyword">void</span> *, &amp;m_loop),</span><br><span class="line">                                  Q_ARG(qint64, offset));</span><br><span class="line">        m_loop.exec();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// For non-GUI threads, QEventLoop would cause a deadlock, so we simply use a blocking call.</span></span><br><span class="line">        <span class="comment">// (Does not hurt as no messages need to be processed either during the open operation).</span></span><br><span class="line">        QMetaObject::invokeMethod(<span class="keyword">this</span>, <span class="string">"slotOpen"</span>, Qt::BlockingQueuedConnection,</span><br><span class="line">                                  Q_ARG(<span class="keyword">void</span> *, &amp;bSuccess),</span><br><span class="line">                                  Q_ARG(<span class="keyword">void</span> *, <span class="literal">NULL</span>),</span><br><span class="line">                                  Q_ARG(qint64, offset));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bSuccess;</span><br><span class="line">    <span class="comment">// Please note that it's perfectly safe to wait on the return Q_ARG,</span></span><br><span class="line">    <span class="comment">// as we wait for the invokeMethod call to complete.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参数通过指针方便地传递Q_ARG()。在这种情况下，这是完全合法的，因为我们等待时隙完成任务，所以在线程仍处于活动状态时，它们不会被无意中断开。这样我们也可以得到结果（成功或数据在read()通话的情况下）。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> webfile::workerOpen(qint64 offset <span class="comment">/*= 0*/</span>)</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"webfile::open(): start offset ="</span> &lt;&lt; offset;</span><br><span class="line"></span><br><span class="line">    clear();</span><br><span class="line">    resetReadFails();</span><br><span class="line">    close();</span><br><span class="line"></span><br><span class="line">    QNetworkAccessManager *manager = <span class="keyword">new</span> QNetworkAccessManager(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_pNetworkProxy != <span class="literal">NULL</span>)</span><br><span class="line">        manager-&gt;setProxy(*m_pNetworkProxy);</span><br><span class="line"></span><br><span class="line">    connect(manager, SIGNAL(proxyAuthenticationRequired(<span class="keyword">const</span> QNetworkProxy &amp;, QAuthenticator *)),</span><br><span class="line">      SLOT(slotProxyAuthenticationRequired(<span class="keyword">const</span> QNetworkProxy &amp;, QAuthenticator *)));</span><br><span class="line">    connect(manager, SIGNAL(authenticationRequired(QNetworkReply *, QAuthenticator *)),</span><br><span class="line">      SLOT(slotAuthenticationRequired(QNetworkReply *, QAuthenticator *)));</span><br><span class="line"></span><br><span class="line">    QNetworkRequest request;</span><br><span class="line"></span><br><span class="line">    request.setUrl(m_url);</span><br><span class="line">    request.setRawHeader(<span class="string">"User-Agent"</span>, <span class="string">"Qt NetworkAccess 1.3"</span>);</span><br><span class="line"></span><br><span class="line">    m_nPos = offset;</span><br><span class="line">    <span class="keyword">if</span> (m_nPos)</span><br><span class="line">    &#123;</span><br><span class="line">        QByteArray data;</span><br><span class="line">        QString strData("bytes=" + QString::number(m_nPos) + "-");</span><br><span class="line"></span><br><span class="line">        data = strData.toLatin1();</span><br><span class="line">        request.setRawHeader(<span class="string">"Range"</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_pReply = manager-&gt;get(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_pReply == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"webfile::open(): network error"</span>;</span><br><span class="line">        m_NetworkError = QNetworkReply::UnknownNetworkError;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the read buffer size</span></span><br><span class="line">    m_pReply-&gt;setReadBufferSize(m_nBufferSize);</span><br><span class="line"></span><br><span class="line">    connect(m_pReply, SIGNAL(error(QNetworkReply::NetworkError)),</span><br><span class="line">        SLOT(slotError(QNetworkReply::NetworkError)));</span><br><span class="line">    connect(m_pReply, SIGNAL(sslErrors(QList&lt;QSslError&gt;)),</span><br><span class="line">        SLOT(slotSslErrors(QList&lt;QSslError&gt;)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!waitForConnect(m_nOpenTimeOutms, manager))</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"webfile::open(): timeout"</span>;</span><br><span class="line">        m_NetworkError = QNetworkReply::TimeoutError;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_pReply == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"webfile::open(): cancelled"</span>;</span><br><span class="line">        m_NetworkError = QNetworkReply::OperationCanceledError;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_pReply-&gt;error() != QNetworkReply::NoError)</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"webfile::open(): error"</span> &lt;&lt; m_pReply-&gt;errorString();</span><br><span class="line">        m_NetworkError = m_pReply-&gt;error();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_NetworkError      = m_pReply-&gt;error();</span><br><span class="line"></span><br><span class="line">    m_strContentType    = m_pReply-&gt;header(QNetworkRequest::ContentTypeHeader).toString();</span><br><span class="line">    m_LastModified      = m_pReply-&gt;header(QNetworkRequest::LastModifiedHeader).toDateTime();</span><br><span class="line">    m_nSize             = m_pReply-&gt;header(QNetworkRequest::ContentLengthHeader).toULongLong();</span><br><span class="line"></span><br><span class="line">    m_nResponse         = m_pReply-&gt;attribute(QNetworkRequest::HttpStatusCodeAttribute).toInt();</span><br><span class="line">    m_strResponse       = m_pReply-&gt;attribute(QNetworkRequest::HttpReasonPhraseAttribute).toString();</span><br><span class="line">    m_bHaveSize =  (m_nSize ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    m_nSize += m_nPos;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error() != QNetworkReply::NoError)</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"webfile::open(): error"</span> &lt;&lt; error();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_NetworkError = response2error(m_nResponse);</span><br><span class="line"></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"webfile::open(): end response"</span> &lt;&lt; response()</span><br><span class="line">      &lt;&lt; <span class="string">"error"</span> &lt;&lt; error() &lt;&lt; <span class="string">"size"</span> &lt;&lt; m_nSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (response() == <span class="number">200</span> || response() == <span class="number">206</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不要忘记等待功能：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> webfile::waitForConnect(<span class="keyword">int</span> nTimeOutms, QNetworkAccessManager *manager)</span><br><span class="line">&#123;</span><br><span class="line">    QTimer *timer = <span class="literal">NULL</span>;</span><br><span class="line">    QEventLoop eventLoop;</span><br><span class="line">    <span class="keyword">bool</span> bReadTimeOut = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    m_bReadTimeOut = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nTimeOutms &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        timer = <span class="keyword">new</span> QTimer(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        connect(timer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(slotWaitTimeout()));</span><br><span class="line">        timer-&gt;setSingleShot(<span class="literal">true</span>);</span><br><span class="line">        timer-&gt;start(nTimeOutms);</span><br><span class="line"></span><br><span class="line">        connect(<span class="keyword">this</span>, SIGNAL(signalReadTimeout()), &amp;eventLoop, SLOT(quit()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Wait on QNetworkManager reply here</span></span><br><span class="line">    connect(manager, SIGNAL(finished(QNetworkReply *)), &amp;eventLoop, SLOT(quit()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_pReply != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Preferrably we wait for the first reply which comes faster than the finished signal</span></span><br><span class="line">        connect(m_pReply, SIGNAL(readyRead()), &amp;eventLoop, SLOT(quit()));</span><br><span class="line">    &#125;</span><br><span class="line">    eventLoop.exec();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timer != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        timer-&gt;stop();</span><br><span class="line">        <span class="keyword">delete</span> timer;</span><br><span class="line">        timer = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bReadTimeOut = m_bReadTimeOut;</span><br><span class="line">    m_bReadTimeOut = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> !bReadTimeOut;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>精华都已经全部讲解了，如果需要全部源码，可以发邮件给我。</p>
<h2 id="Tcp通信案例-简单"><a href="#Tcp通信案例-简单" class="headerlink" title="Tcp通信案例(简单)"></a>Tcp通信案例(简单)</h2><p>Qt 这边儿核心通信逻辑经过封装，写起来比较简单，其实整个看起来就像是在槽函数里面填空一样。</p>
<ul>
<li>建立相关连接逻辑</li>
<li>找到相应的信号，绑定槽函数</li>
<li>实现槽函数</li>
</ul>
<p>这里演示的是一个简单的 Tcp 建立连接，然后通信的过程，整个<strong>运行效果</strong>如下:</p>
<p>先写 server 端:(可以用 nc 代替客户端进行测试)</p>
<p><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple1.jpg" alt=" "></p>
<p>多个客户端同时连接:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple3.jpg" alt=" "></p>
<p>测试发送数据: (S -&gt; C)(这里客户端是局域网的另外一台电脑)<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple2.jpg" alt=" "></p>
<p>测试发送数据: (C -&gt; S)<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple4.jpg" alt=" "></p>
<p>测试分别从 C端，S端断开连接:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_simple5.jpg" alt=" "></p>
<p>客户端界面，略。(直接看代码吧，太简单了)</p>
<p>完整的代码如下:</p>
<p>客户端逻辑:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnConnect_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnClose_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::clientwidget *ui;</span><br><span class="line">    QTcpSocket *tcpSocket;</span><br><span class="line">    QString currentInfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******实现如下******/</span></span><br><span class="line">clientwidget::clientwidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::clientwidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    setWindowTitle(<span class="string">"客户端"</span>);</span><br><span class="line"></span><br><span class="line">    tcpSocket = <span class="literal">nullptr</span>;</span><br><span class="line">    tcpSocket = <span class="keyword">new</span> QTcpSocket(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    connect(tcpSocket, &amp;QTcpSocket::connected, [=]()&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;currentInfo += <span class="string">"成功和服务器建立连接\n"</span>;</span><br><span class="line">        ui-&gt;txRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    connect(tcpSocket, &amp;QTcpSocket::disconnected, [=]()&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;currentInfo += <span class="string">"和服务器连接断开\n"</span>;</span><br><span class="line">        ui-&gt;txRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    connect(tcpSocket, &amp;QTcpSocket::readyRead, [=]()&#123;</span><br><span class="line">        <span class="comment">//获取对方发送的内容</span></span><br><span class="line">        QByteArray <span class="built_in">array</span> = tcpSocket-&gt;readAll();</span><br><span class="line">        <span class="comment">//追加到编辑区中</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;currentInfo += QString(<span class="built_in">array</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;currentInfo += <span class="string">"\n"</span>;</span><br><span class="line">        ui-&gt;txRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clientwidget::~clientwidget()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理连接操作</span></span><br><span class="line"><span class="keyword">void</span> clientwidget::on_btnConnect_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获取服务器的ip 和 端口</span></span><br><span class="line">    QString ip = ui-&gt;leIP-&gt;text();</span><br><span class="line">    quint16 port = ui-&gt;lePort-&gt;text().toInt();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果主动断开连接时已经关闭了，那么重新建立即可</span></span><br><span class="line">    <span class="keyword">if</span> (!tcpSocket) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"new socket"</span>;</span><br><span class="line">       tcpSocket = <span class="keyword">new</span> QTcpSocket(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//主动和服务器建立连接</span></span><br><span class="line">    tcpSocket-&gt;connectToHost(QHostAddress(ip), port);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置发送相应</span></span><br><span class="line"><span class="keyword">void</span> clientwidget::on_btnSend_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!tcpSocket) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取编辑框内容</span></span><br><span class="line">    QString str = ui-&gt;txSend-&gt;toPlainText();</span><br><span class="line">    tcpSocket-&gt;write(str.toUtf8().data());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示出来</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;currentInfo += str;</span><br><span class="line">    ui-&gt;txRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line">    ui-&gt;txSend-&gt;clear();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> clientwidget::on_btnClose_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//断开连接</span></span><br><span class="line">    <span class="keyword">if</span> (tcpSocket) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"delete"</span> ;</span><br><span class="line">        tcpSocket-&gt;close(); <span class="comment">//自动调用 tcpSocket-&gt;disconnectFromHost();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//不要写下面的两句，否则之前绑定的槽函数失效(不再显示信息)</span></span><br><span class="line">        <span class="comment">//还是用系统的close()比较好</span></span><br><span class="line">        <span class="comment">/*delete tcpSocket;</span></span><br><span class="line"><span class="comment">        tcpSocket = nullptr;*/</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意一下：</p>
<ul>
<li>c和s端注意检查tcp连接是否存活</li>
<li>断开连接并不是要删除原来分配的套接字，只是关闭文件而已，要用close，而不是delete</li>
</ul>
<p>服务端代码:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnClose_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::Widget *ui;</span><br><span class="line">    QString currentInfo;</span><br><span class="line">    QTcpServer *tcpServer; <span class="comment">//监听套接字</span></span><br><span class="line">    QTcpSocket *tcpSocket; <span class="comment">//通信套接字</span></span><br><span class="line"></span><br><span class="line">Widget::Widget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>-&gt;setWindowTitle(<span class="string">"服务器"</span>);</span><br><span class="line">    tcpServer = <span class="literal">nullptr</span>;</span><br><span class="line">    tcpSocket = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建监听套接字</span></span><br><span class="line">    tcpServer = <span class="keyword">new</span> QTcpServer(<span class="keyword">this</span>);  <span class="comment">//自动回收空间(指定父对象)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定和Listen</span></span><br><span class="line">    tcpServer-&gt;listen(QHostAddress::Any, <span class="number">9999</span>); <span class="comment">//默认绑定当前网卡的所有IP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定 建立连接 的信号</span></span><br><span class="line">    connect(tcpServer, &amp;QTcpServer::newConnection, [=]()&#123;</span><br><span class="line">        <span class="comment">//成功连接的处理</span></span><br><span class="line">        <span class="comment">//取出建立好连接的套接字</span></span><br><span class="line">        tcpSocket =tcpServer-&gt;nextPendingConnection(); <span class="comment">//当前取出一个</span></span><br><span class="line">        <span class="comment">//获取对端信息(ip and port) 地址要进行网络地址到本机地址的转换</span></span><br><span class="line">        QString ip = tcpSocket-&gt;peerAddress().toString();<span class="comment">//.toIPv4Address();</span></span><br><span class="line">        quint16 port = tcpSocket-&gt;peerPort();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>-&gt;currentInfo += QString(<span class="string">"[%1:%2]:成功连接了"</span>).arg(ip).arg(port);</span><br><span class="line">        <span class="keyword">this</span>-&gt;currentInfo += <span class="string">"\n"</span>;</span><br><span class="line">        ui-&gt;teRead-&gt;setText(currentInfo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 只有在连接成功的基础上才谈接收(否则 tcpSocket对象为空)</span></span><br><span class="line">        <span class="comment">//绑定 接收 的信号 (通信套接字)</span></span><br><span class="line">        connect(tcpSocket, &amp;QTcpSocket::readyRead, [=]()&#123;</span><br><span class="line">            <span class="comment">//有数据可读 (取出来，显示)</span></span><br><span class="line">            QByteArray <span class="built_in">array</span> = tcpSocket-&gt;readAll();</span><br><span class="line">            <span class="keyword">this</span>-&gt;currentInfo.append(<span class="string">"received from ["</span></span><br><span class="line">                                     + ip + <span class="string">":"</span> + QString::number(port)</span><br><span class="line">                                     +<span class="string">"]"</span>+ <span class="built_in">array</span>.data() + <span class="string">"\n"</span>);</span><br><span class="line">            ui-&gt;teRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理断开 (客户端或者服务器这边儿)</span></span><br><span class="line">        connect(tcpSocket, &amp;QTcpSocket::disconnected, [=]()&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;currentInfo += <span class="string">"断开当前连接\n"</span>;</span><br><span class="line">            ui-&gt;teRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~Widget()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭当前连接</span></span><br><span class="line"><span class="keyword">void</span> Widget::on_btnClose_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//主动关闭当前连接</span></span><br><span class="line">    <span class="keyword">if</span>(tcpSocket) &#123;</span><br><span class="line">        tcpSocket-&gt;disconnectFromHost(); <span class="comment">//服务器主动断开</span></span><br><span class="line">        tcpSocket-&gt;close();</span><br><span class="line">        tcpSocket = <span class="literal">nullptr</span>; <span class="comment">//这里写没有关系，因为每次都是建立的新的 tcpSocket;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    if(tcpServer) &#123;</span></span><br><span class="line"><span class="comment">        tcpServer-&gt;close();</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">//this-&gt;close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理发送</span></span><br><span class="line"><span class="keyword">void</span> Widget::on_btnSend_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!tcpSocket) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取编辑区内容</span></span><br><span class="line">    QString str = ui-&gt;teWrite-&gt;toPlainText()+<span class="string">"\n"</span>;</span><br><span class="line">    <span class="comment">//给对方发送数据(只会给当前连接的对端发送)</span></span><br><span class="line">    tcpSocket-&gt;write(str.toUtf8().data());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示在currentInfo上面</span></span><br><span class="line">    <span class="comment">//获取对端信息(ip and port) 地址要进行网络地址到本机地址的转换</span></span><br><span class="line">    QString ip = tcpSocket-&gt;peerAddress().toString();<span class="comment">//.toIPv4Address();</span></span><br><span class="line">    quint16 port = tcpSocket-&gt;peerPort();</span><br><span class="line">    <span class="keyword">this</span>-&gt;currentInfo = <span class="keyword">this</span>-&gt;currentInfo + <span class="string">"server sent to ["</span> + ip</span><br><span class="line">            +<span class="string">" : "</span> + QString::number(port) +<span class="string">"]"</span> + str.toUtf8().data();</span><br><span class="line">    ui-&gt;teRead-&gt;setText(<span class="keyword">this</span>-&gt;currentInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送完毕, 清空输入端</span></span><br><span class="line">    ui-&gt;teWrite-&gt;clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务端写完，可以直接用 <code>nc</code> 工具测试, <code>lsof -i : 9999</code> 查看端口号.</p>
<h2 id="Tcp文件传输-简单"><a href="#Tcp文件传输-简单" class="headerlink" title="Tcp文件传输(简单)"></a>Tcp文件传输(简单)</h2><p>套接字编程 + 网络文件读写。基本是上一个案例的基础上加上网络文件读写处理。</p>
<p>先说要注意的细节:</p>
<ul>
<li>服务器发送时注意粘包问题，即发送文件头的时候后面跟着数据呢;(tcp会凑够数再发送, 或者延迟发送)<ul>
<li>解决方法先读指定长度字节的头部或者发完头部信息，隔一段时间再发送文件数据或者干脆分两次发送</li>
<li>本案例，采用两段式传输，先传输文件头，后传输文件体，也就是客户端第二次触发 readReay 的时候才读取文件体</li>
</ul>
</li>
<li>传输中途断开连接了，选择文件之后断开连接了等情况， 先检查连接，再传输</li>
<li>进度条显示不要越界等</li>
<li>服务器端写的时候处理的好发送量，例如4K为单位；那么客户端读的时候也方便</li>
<li>绑定 readRead, 一定放在 newConnection 里面（没有连接建立的情况下绑定肯定出异常）</li>
</ul>
<p>下面看看运行的效果以及需要处理的细节：</p>
<p>没有建立连接的情况下，不能选择传输文件: (更不要提发送文件)<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file1.jpg" alt=" "></p>
<p>连接建立之后，按钮可用:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file2.jpg" alt=" "></p>
<p>不管哪一方断开连接，按钮都不可用:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file3.jpg" alt=" "></p>
<p>选择文件后，断开连接，要清理连接信息以及所选文件等：<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file4.jpg" alt=" "></p>
<p>文件发送完毕，服务器端主动断开连接:(这是没有写客户端的时候测试)<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file5.jpg" alt=" "></p>
<p>文件发送完毕，客户端发送信息通知服务端，然后服务端收到信息后，显示“客户端”已经收到文件:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file5-1.jpg" alt=" "><br>(这里其实，选择文件也应该 setEnable(false);)</p>
<p>中途遇到的<strong>小问题记载</strong>:<br>1.进度条显示应该是 M 为单位，即 1024 的倍数, 结果写错了:</p>
<p><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file6.jpg" alt=" "><br>2.重复连续发送文件，第二次传输文件，发现总是受到的文件少一个字节<br>应该在第二次传输之前，设置为下一次又应该传输文件头了。</p>
<p><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_tmp.jpg" alt=" "><br>3.粘包问题:<br>客户端给服务器端发送收到的字节序号，每次服务器是分简单批次字节写出，然后可以看到，服务端每次收到的都是服务端分多次写出的数据。<br>写就是生产者貌似生产多了，消费者接受太慢了？（其实是客户端这边 TCP 发包时，看到字节太少，这里 delay发送，组包，提高传输效率）<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_byte1.jpg" alt=" "></p>
<p>详细代码片段如下：</p>
<p>客户端:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_byte2.jpg" alt=" "></p>
<p>服务端:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-tcp_file_byte3.jpg" alt=" "></p>
<p>两次发送，以避免字节序粘包大致逻辑如下:<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-01-qt_85.jpg" alt=" "></p>
<p><strong>核心代码如下</strong>:</p>
<p>客户端:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnConnect_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">closeEvent</span><span class="params">(QCloseEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::ClientWidget *ui;</span><br><span class="line"></span><br><span class="line">    QTcpSocket *tcpSocket; <span class="comment">//通信套接字</span></span><br><span class="line"></span><br><span class="line">    QFile file;</span><br><span class="line">    QString fileName; <span class="comment">//文件名</span></span><br><span class="line">    quint64 fileSize; <span class="comment">//文件大小</span></span><br><span class="line">    quint64 recvSize; <span class="comment">//已经发送的大小</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isHead; <span class="comment">//标记本次是否是接收文件头</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//实现:</span></span><br><span class="line">ClientWidget::ClientWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::ClientWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    setWindowTitle(<span class="string">"客户端"</span>);</span><br><span class="line">    ui-&gt;progressBar-&gt;setValue(<span class="number">0</span>); <span class="comment">//初始化进度条</span></span><br><span class="line"></span><br><span class="line">    tcpSocket = <span class="keyword">new</span> QTcpSocket(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//然后就等着连接之后，别人给我发东西</span></span><br><span class="line">    isHead = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//绑定读</span></span><br><span class="line">    connect(tcpSocket, &amp;QTcpSocket::readyRead, [=]()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接全部读取</span></span><br><span class="line">        QByteArray buf = tcpSocket-&gt;readAll(); <span class="comment">//第一次肯定是拿到头</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isHead) &#123;  <span class="comment">//之所以可以这样做，完全是因为已知服务器端会分两次写</span></span><br><span class="line">            isHead = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//解析头信息 (拆包) "filename##size" (初始化数据)</span></span><br><span class="line">            <span class="comment">//QString section() 方法, 按段拆包</span></span><br><span class="line">            fileName = QString(buf).section(<span class="string">"##"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            fileSize = QString(buf).section(<span class="string">"##"</span>, <span class="number">1</span>, <span class="number">1</span>).toInt();</span><br><span class="line">            recvSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(fileName.isEmpty() || fileSize == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//做一下异常处理</span></span><br><span class="line">                qDebug() &lt;&lt; <span class="string">"收到的文件可能是空文件"</span>;</span><br><span class="line">                fileName = <span class="string">"NULL"</span>;</span><br><span class="line">                fileSize = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建文件并打开</span></span><br><span class="line">            file.setFileName(fileName); <span class="comment">//和可执行文件同一路径</span></span><br><span class="line">            <span class="keyword">bool</span> isOpen = file.open(QIODevice::WriteOnly);</span><br><span class="line">            <span class="keyword">if</span>(!isOpen) &#123;</span><br><span class="line">                qDebug() &lt;&lt; <span class="string">"创建文件出错了"</span>; <span class="comment">//是不是要重试?</span></span><br><span class="line">                tcpSocket-&gt;close();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//开始设置进度条信息</span></span><br><span class="line">            ui-&gt;progressBar-&gt;setMinimum(<span class="number">0</span>); <span class="comment">//最小值</span></span><br><span class="line">            ui-&gt;progressBar-&gt;setMaximum(fileSize/<span class="number">1024</span>); <span class="comment">//最大值</span></span><br><span class="line">            ui-&gt;progressBar-&gt;setValue(<span class="number">0</span>); <span class="comment">//当前值</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果创建文件ok, 提示一下准备收取文件</span></span><br><span class="line">            QMessageBox::information(<span class="keyword">this</span>, <span class="string">"文件信息"</span>,  QString(<span class="string">"即将接收文件: %1, 大小 %2 kb"</span>)</span><br><span class="line">                                     .arg(fileName).arg(fileSize/<span class="number">1024</span>));</span><br><span class="line"></span><br><span class="line">            tcpSocket-&gt;write(<span class="string">"file"</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//并非读取头， 而是读取文件内容</span></span><br><span class="line">            <span class="comment">//(注意上面用的是 readAll, 不用担心服务器方会根据链路带宽进行调整发送的大小)</span></span><br><span class="line">            <span class="comment">//一般就是会发送多次, 但是经过TCP的组织，满足一定长度才真正发出去</span></span><br><span class="line">            quint64 len = file.write(buf);</span><br><span class="line">            <span class="comment">//qDebug() &lt;&lt; "client : write " + QString::number(len) + " Bytes to file this time " ;</span></span><br><span class="line">            recvSize += len;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*这里发送长度给服务器打印，为了 演示一下 粘包问题 */</span></span><br><span class="line">            tcpSocket-&gt;write( QString::number(recvSize).toUtf8().data());</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">"粘包问题  Client: "</span> &lt;&lt;  QString::number(recvSize);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//同时更新进度条</span></span><br><span class="line">            ui-&gt;progressBar-&gt;setValue(recvSize/<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (recvSize == fileSize) &#123;</span><br><span class="line">                QMessageBox::information(<span class="keyword">this</span>, <span class="string">"完成"</span>, <span class="string">"文件接收完成, 通知服务器"</span>);</span><br><span class="line">                tcpSocket-&gt;write(<span class="string">"done"</span>); <span class="comment">//发给服务器, 服务器收到后显示一下发送完毕.</span></span><br><span class="line">                isHead = <span class="literal">true</span>; <span class="comment">//避免下次直接又重新读 (如果没有这一句，连续发送就有问题)</span></span><br><span class="line"></span><br><span class="line">                file.close(); <span class="comment">//已经全部写入文件，现在关闭文件</span></span><br><span class="line">                tcpSocket-&gt;close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ClientWidget::~ClientWidget()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主动连接过去</span></span><br><span class="line"><span class="keyword">void</span> ClientWidget::on_btnConnect_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    QString ip = ui-&gt;leIP-&gt;text();</span><br><span class="line">    quint16 port = ui-&gt;lePort-&gt;text().toInt();</span><br><span class="line"></span><br><span class="line">    tcpSocket-&gt;connectToHost(QHostAddress(ip), port);</span><br><span class="line">    ui-&gt;progressBar-&gt;setValue(<span class="number">0</span>); <span class="comment">//初始化进度条</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> ClientWidget::closeEvent(QCloseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (tcpSocket-&gt;isOpen()) &#123;</span><br><span class="line">        tcpSocket-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(file.isOpen()) &#123;</span><br><span class="line">        file.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务端:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnFile_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::ServerWidget *ui;</span><br><span class="line"></span><br><span class="line">    QTcpServer *tcpServer;</span><br><span class="line">    QTcpSocket *tcpSocket;</span><br><span class="line"></span><br><span class="line">    QFile file;</span><br><span class="line">    QString fileName; <span class="comment">//文件名</span></span><br><span class="line">    quint64 fileSize; <span class="comment">//文件大小</span></span><br><span class="line">    quint64 sendSize; <span class="comment">//已经发送的大小</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//服务端收到客户端要文件题的信息启动定时器发送文件体</span></span><br><span class="line">    QTimer timer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*********实现*********/</span></span><br><span class="line">ServerWidget::ServerWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::ServerWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    setWindowTitle(<span class="string">"服务器端端口 9999"</span>);</span><br><span class="line">    ui-&gt;btnFile-&gt;setEnabled(<span class="literal">false</span>); <span class="comment">//当前没有连接建立, 不能按按钮</span></span><br><span class="line">    ui-&gt;btnSend-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定并监听</span></span><br><span class="line">    tcpServer = <span class="keyword">new</span> QTcpServer(<span class="keyword">this</span>);</span><br><span class="line">    tcpServer-&gt;listen(QHostAddress::Any, <span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定连接成功槽函数</span></span><br><span class="line">    connect(tcpServer, &amp;QTcpServer::newConnection, [=]()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取出建立好的连接套接字</span></span><br><span class="line">        tcpSocket = tcpServer-&gt;nextPendingConnection();</span><br><span class="line">        <span class="comment">//获取对方的IP和Port</span></span><br><span class="line">        QString ip = tcpSocket-&gt;peerAddress().toString();</span><br><span class="line">        quint16 port = tcpSocket-&gt;peerPort();</span><br><span class="line"></span><br><span class="line">        ui-&gt;textEdit-&gt;setText(QString(<span class="string">"[%1:%2] 连接成功"</span>).arg(ip).arg(port));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//成功连接后，让选择文件和发送按钮，可用</span></span><br><span class="line">        ui-&gt;btnFile-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定连接已经断开</span></span><br><span class="line">        connect(tcpSocket, &amp;QTcpSocket::disconnected, [=]()&#123;</span><br><span class="line">            <span class="comment">//可能是对方已经断开连接</span></span><br><span class="line">            qDebug() &lt;&lt; <span class="string">"连接已经断开"</span>;</span><br><span class="line">            <span class="keyword">if</span>(tcpSocket) &#123;</span><br><span class="line">                ui-&gt;textEdit-&gt;append(<span class="string">"当前连接已经断开, 清理有关信息"</span>);</span><br><span class="line">                qDebug() &lt;&lt; <span class="string">"我也主动断开当前连接"</span>;</span><br><span class="line">                tcpSocket-&gt;close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//清理打开的文件信息</span></span><br><span class="line">            fileName.clear();</span><br><span class="line">            fileSize = <span class="number">0</span>;</span><br><span class="line">            sendSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//disable btn</span></span><br><span class="line">            ui-&gt;btnFile-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            ui-&gt;btnSend-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定一下客户端的发送数据 readRead, 一定放在newConnection里面</span></span><br><span class="line">        connect(tcpSocket, &amp;QTcpSocket::readyRead, [=]()&#123;</span><br><span class="line">            <span class="comment">//取出来客户端发送的信息</span></span><br><span class="line">            QString buf(tcpSocket-&gt;readAll());</span><br><span class="line">            <span class="keyword">if</span> (buf == <span class="string">"done"</span>) &#123;</span><br><span class="line">                ui-&gt;textEdit-&gt;append(<span class="string">"客户端已经完全接受文件"</span>);</span><br><span class="line">                file.close();</span><br><span class="line">                tcpSocket-&gt;close(); <span class="comment">//一次连接只传递一个文件</span></span><br><span class="line"></span><br><span class="line">                ui-&gt;btnFile-&gt;setEnabled(<span class="literal">false</span>); <span class="comment">//除非有新的连接</span></span><br><span class="line">                ui-&gt;btnSend-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (buf == <span class="string">"file"</span>) &#123;</span><br><span class="line">                <span class="comment">//启动定时器，开始发第二波(即文件数据)</span></span><br><span class="line">                timer.start(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//其他情况打印一下从客户端发来的长度信息 --- 演示一下粘包</span></span><br><span class="line">                qDebug() &lt;&lt; <span class="string">"粘包问题  Server: "</span> + buf;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定定时器的 timerout事件</span></span><br><span class="line">    connect(&amp;timer, &amp;QTimer::timeout, [=]()&#123;</span><br><span class="line">        <span class="comment">//已经成功触发过来，调用 sendFile, 所以先关闭定时器</span></span><br><span class="line">        timer.stop();</span><br><span class="line">        sendFile();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServerWidget::~ServerWidget()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//选择文件按钮</span></span><br><span class="line"><span class="keyword">void</span> ServerWidget::on_btnFile_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    QString filePath = QFileDialog::getOpenFileName(<span class="keyword">this</span>, <span class="string">"open"</span>, <span class="string">"../"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!filePath.isEmpty()) &#123; <span class="comment">//路径有效</span></span><br><span class="line">        fileName.clear();</span><br><span class="line">        fileSize = <span class="number">0</span>;</span><br><span class="line">        sendSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读文件信息(只读打开) : 文件名， 大小</span></span><br><span class="line">        <span class="function">QFileInfo <span class="title">info</span><span class="params">(filePath)</span></span>;</span><br><span class="line">        fileName = info.fileName();<span class="comment">//baseName();</span></span><br><span class="line">        fileSize = info.size();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//只读打开(建立文件关联)</span></span><br><span class="line">        file.setFileName(filePath);</span><br><span class="line">        <span class="keyword">bool</span> isOpen = file.open(QIODevice::ReadOnly);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!isOpen) &#123;</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">"只读模式打开文件失败"</span>;</span><br><span class="line">            <span class="comment">//相关处理</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//提示您已经打开文件了</span></span><br><span class="line">        ui-&gt;textEdit-&gt;append(filePath + <span class="string">"已经选定, 文件大小:"</span> + QString::number(fileSize));</span><br><span class="line"></span><br><span class="line">        ui-&gt;btnFile-&gt;setEnabled(<span class="literal">false</span>); <span class="comment">//只能选一次，不能重复选择</span></span><br><span class="line">        ui-&gt;btnSend-&gt;setEnabled(<span class="literal">true</span>); <span class="comment">//可以发送</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//没有选择文件</span></span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"路径无效的处理代码开始执行"</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送文件按钮</span></span><br><span class="line"><span class="keyword">void</span> ServerWidget::on_btnSend_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//先发送文件头信息, 格式: 文件名##文件大小</span></span><br><span class="line">    QString head = QString(<span class="string">"%1##%2"</span>).arg(fileName).arg(fileSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//你发送的时候，对方主动断开了连接</span></span><br><span class="line">    <span class="keyword">if</span> (tcpSocket-&gt;isWritable()) &#123;</span><br><span class="line">        quint64 len = tcpSocket-&gt;write(head.toUtf8()); <span class="comment">//发送头部</span></span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123; <span class="comment">//头部发送成功, 开始发送文件内容</span></span><br><span class="line">            <span class="comment">//防止TCP粘包 (延迟发送文件内容, 借助 QTimer的 timeout 信号槽)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//这种策略不管用， 如果对方确认的时间过长，对方还是会一次性读完小文件。</span></span><br><span class="line">            <span class="comment">//---发送文件就交给 readyRead槽函数吧--即等待客户端说能发了才发</span></span><br><span class="line">            <span class="comment">//timer.start(100); //定时器的作用就是100ms后调转到 sendFile 开始真正的文件发送工作</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            qDebug() &lt;&lt; <span class="string">"头部信息发送失败, 直接关闭文件"</span> ;</span><br><span class="line">            file.close(); <span class="comment">//关闭文件</span></span><br><span class="line">            ui-&gt;btnFile-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">            ui-&gt;btnSend-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"连接已经断开, 不能发送"</span>; <span class="comment">//任何时候断开连接了，就不能让用户点击这个按妞</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> ServerWidget::sendFile()</span><br><span class="line">&#123;</span><br><span class="line">    quint64 len = <span class="number">0</span>; <span class="comment">//当前读了多少</span></span><br><span class="line">    <span class="keyword">if</span> (!file.isOpen()) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">"文件都没有打开，发送不了"</span>;</span><br><span class="line">        ui-&gt;btnFile-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;btnSend-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//按照 4K 大小来发送</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">char</span> buf[<span class="number">4</span>*<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;; <span class="comment">//每次发送4K</span></span><br><span class="line">        len = file.read(buf, <span class="keyword">sizeof</span>(buf)); <span class="comment">//先读</span></span><br><span class="line">        <span class="comment">//if (lend &gt; 0 ) &#123; //读多少发多少</span></span><br><span class="line">            sendSize += tcpSocket-&gt;write(buf, len);</span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">    &#125; <span class="keyword">while</span>(len &gt; <span class="number">0</span>);<span class="comment">//while(sendSize &lt; fileSize); //没有发送完毕或者每次都能读到数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 交给客户端的通知消息来做下面的事儿</span></span><br><span class="line"><span class="comment">    //sendSize = fileSize</span></span><br><span class="line"><span class="comment">    if (sendSize == fileSize) &#123;</span></span><br><span class="line"><span class="comment">        ui-&gt;textEdit-&gt;append("文件已经发送完毕; 断开当前连接");</span></span><br><span class="line"><span class="comment">        file.close();</span></span><br><span class="line"><span class="comment">        //断开客户端（一次只发送一个）</span></span><br><span class="line"><span class="comment">        tcpSocket-&gt;close();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ui-&gt;btnFile-&gt;setEnabled(false);</span></span><br><span class="line"><span class="comment">    ui-&gt;btnSend-&gt;setEnabled(false);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Udp通信案例-简单"><a href="#Udp通信案例-简单" class="headerlink" title="Udp通信案例(简单)"></a>Udp通信案例(简单)</h2><p>一个 peer to peer 的通信程序(相互发送内容, 广播，组播)<br><em>但广播需要路由支持</em>.</p>
<p>最终运行效果大致如下: (建立套接字之后就开始发送数据报)<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple1.jpg" alt=" "></p>
<p>开发过程阶段截图：<br>1.测试接收：<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple2.jpg" alt=" "><br>2.测试发送<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple3.jpg" alt=" "><br>3.测试组播 (先加入组播地址才能收到)<br><img src="http://omotkhw3y.bkt.clouddn.com/2018-01-26-udp_simple4.jpg" alt=" "></p>
<p>核心代码也比较简单，主要是看其流程:<br>(端对端，只写一份代码即可)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dealMsg</span><span class="params">()</span></span>;  <span class="comment">//处理读的槽函数(接收对方发送的数据)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnClose_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on_btnSend_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QUdpSocket *udpSocket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********实现部分**********/</span></span><br><span class="line">Widget::Widget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分配空间, 指定父对象(自动回收)</span></span><br><span class="line">    udpSocket = <span class="keyword">new</span> QUdpSocket(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="comment">//(因为只有一个界面，所以先运行一个8888,然后在运行一个9999, 一共两个实例)</span></span><br><span class="line">    <span class="comment">//udpSocket-&gt;bind(8888); //最好指定一下是绑定的 ipv4的端口，不然绑定组播地址报错</span></span><br><span class="line">    udpSocket-&gt;bind(QHostAddress::AnyIPv4, <span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;setWindowTitle(<span class="string">"我的端口 8888"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定读操作</span></span><br><span class="line">    connect(udpSocket, &amp;QUdpSocket::readyRead, <span class="keyword">this</span>, &amp;Widget::dealMsg);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果接收组播的话</span></span><br><span class="line">    udpSocket-&gt;joinMulticastGroup(QHostAddress(<span class="string">"224.0.0.2"</span>));</span><br><span class="line">    <span class="comment">//退出组播组</span></span><br><span class="line">    <span class="comment">//udpSocket-&gt;leaveMulticastGroup(QHostAddress("224.0.0.2"));</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Widget::dealMsg()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//读取对方发送的内容</span></span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">//拿到对方的IP和port</span></span><br><span class="line">    QHostAddress cliAddr;  <span class="comment">//局域网广播255.255.255.255(需要权限或者路由允许)</span></span><br><span class="line">    quint16 port;</span><br><span class="line">    qint64 len; <span class="comment">//读到多少内容</span></span><br><span class="line">    len =  udpSocket-&gt;readDatagram(buf, <span class="keyword">sizeof</span>(buf), &amp;cliAddr, &amp;port);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读到了内容， 开始显示</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        QString str = QString(<span class="string">"[%1:%2] %3"</span>)</span><br><span class="line">                .arg(cliAddr.toString())</span><br><span class="line">                .arg((port))</span><br><span class="line">                .arg(buf);</span><br><span class="line">        ui-&gt;textEdit-&gt;setText(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Widget::on_btnClose_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;udpSocket-&gt;close();</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>-&gt;udpSocket;</span><br><span class="line">    <span class="keyword">this</span>-&gt;udpSocket = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;close(); <span class="comment">//关闭窗口</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送处理</span></span><br><span class="line"><span class="keyword">void</span> Widget::on_btnSend_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//先获取指定了的对方的IP和端口</span></span><br><span class="line">    QString ip  = ui-&gt;leIP-&gt;text();</span><br><span class="line">    quint16 port = ui-&gt;lePort-&gt;text().toInt();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断一下是否 ip/port 正常</span></span><br><span class="line">    <span class="comment">//代码略</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取编辑区内容，准备发送</span></span><br><span class="line">    QString str = ui-&gt;textEdit-&gt;toPlainText();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给指定的IP发送数据</span></span><br><span class="line">    udpSocket-&gt;writeDatagram(str.toUtf8(), QHostAddress(ip), port);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~Widget()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>Merlin<br>2017.2 客户端编程谈什么传输层 : )</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/posts/82524a2d/">技术: Qt 网络编程案例汇总</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Merlin</a></p>
        <p><span>发布时间:</span>2017-02-28, 19:36:02</p>
        <p><span>最后更新:</span>2018-04-12, 14:55:17</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/posts/82524a2d/" title="技术: Qt 网络编程案例汇总">http://www.merlinblog.site/posts/82524a2d/</a>
            <span class="copy-path" data-clipboard-text="原文: http://www.merlinblog.site/posts/82524a2d/　　作者: Merlin" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/posts/3a357315/">
                    技术: Python语言
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/posts/a46fcd49/">
                    技术: Qt 线程案例汇总
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#访问网络-简单"><span class="toc-number">1.</span> <span class="toc-text">访问网络(简单)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#同步阻塞下载文件-范例"><span class="toc-number">2.</span> <span class="toc-text">同步阻塞下载文件(范例)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tcp通信案例-简单"><span class="toc-number">3.</span> <span class="toc-text">Tcp通信案例(简单)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tcp文件传输-简单"><span class="toc-number">4.</span> <span class="toc-text">Tcp文件传输(简单)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Udp通信案例-简单"><span class="toc-number">5.</span> <span class="toc-text">Udp通信案例(简单)</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>





    




    <div class="scroll" id="post-nav-button">
        
            <a href="/posts/3a357315/" title="上一篇: 技术: Python语言">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/posts/a46fcd49/" title="下一篇: 技术: Qt 线程案例汇总">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/7ef0bd11/">技巧: iOS 工作流</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1e2300e0/">Golang: 并发聊天室综合案例</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/74edbb6d/">Golang: TCP 文件传输案例</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a8342f6/">Golang: TCP 简单并发服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/aa0a3cc6/">技巧: B站视频下载脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8180668e/">技巧: 多用户共享 Parralles 虚拟机</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/55b0329b/">Golang: 值类型&引用类型坑(12)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ac5ecee9/">Golang: 函数类型实现接口封装问题(11)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/eecafb73/">Golang: struct打印输出问题(10)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8f54ef0c/">Golang: string和byte slie字节问题(9)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8a7f81db/">Golang: time计算问题(8)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d4333ec1/">Golang: chan定义问题(7)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/aec4de55/">Golang: defer 时机问题(6)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e9bf7e00/">Golang: make和new坑(5)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e0c9893e/">Golang: import和package坑(4)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4ff88030/">Golang: runtime.Gosched 问题(3)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/690caed4/">Golang: HTML Template案例(xml新闻解析+并发改进)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4620296/">Golang: JSON 小案例(读配置文件)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/777e9274/">Golang: JSON 综合案例(天气预报)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/21f718fc/">Golang: RESTful 小案例</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ad1d8b3/">Golang: 泛型容器的安全问题 (2)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1e9ef6fe/">Android: APK細粒度的權限管理設計</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3fde375b/">Golang: 内嵌真的不是继承 (1)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/558a5d81/">Android: 密碼學基礎</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2ff459d4/">Android: 彙編語言基礎</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ede42ab6/">Golang: 注意空接口运行时类型 (0)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/bd0987da/">Android: 音频框架&驱动解析</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6c3c68b0/">Gcc: Gcc优化指南(5. 功成身退-总结)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/466242ae/">Gcc: Gcc优化指南(4. Gcc & G++ & 相关工具)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/425935e0/">Gcc: Gcc优化指南(3. Gcc Optimize-核心)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5cd24f32/">Gcc: Gcc优化指南(2. Gcc Options)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/11ea881a/">Gcc: Gcc优化指南(1. Common Problmes of Path & Libs)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1e58a5cc/">量化: 数学和量化研究(0. 总起)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e6805cb0/">Gcc: Gcc优化指南(0. Basic Skills)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/78268fe4/">Golang: 标准库解决方案(8.总结-功成身退)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e3c9a06b/">Golang: 标准库解决方案(7.Concurrency)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/bb600d10/">Golang: 标准库解决方案(6.REST & JSON API)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2f5310cf/">Golang: 标准库解决方案(5.Web Server & Client)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/40bd3fcc/">Golang: 标准库解决方案(4.Math/Time/Archives/Images)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fedfbade/">Golang: 标准库解决方案(3.处理BuildTools,IO,Error)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/42e1a67a/">Golang: 标准库解决方案(2.处理Strings,Bytes,Runes)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/461f0c5f/">Golang: 标准库解决方案(1.听两位大师讲标准库)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/dbbca7df/">Golang: WebGoGoGo(0.Web编程的方方面面)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/187d6c5a/">Golang: WebGoGoGo(0.概述Web编程)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/94df7563/">Golang: Here We Go(5.孰能生巧-Oreilly大师讲解&再练习)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/53a29a57/">Golang: RobPike谈 并发Vs并行</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9b9dc4cb/">Golang: One Video Golang</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9d17f938/">Golang: 标准库解决方案(0.总起)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e5c13927/">Golang: Think in Golang</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/514585e8/">Golang: Here We Go(4.功成身退-资料&面试题)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4f07614d/">Golang: Here We Go(3.登堂入室-全部语法&大量练习)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/872df2cf/">Golang: Here We Go(2.常用命令&代码结构&语法大纲)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/51cffabe/">Golang: Here We Go(1.安装&&脚本)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d740c2ec/">Golang: Here We Go(0.Google工程师介绍)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/590c21ce/">V-skills 专栏指南</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/df51d2c/">技巧: Hexo 置顶问题解决</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4111adcd/">技巧: WordPress 迁移&备份技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d61966e4/">略懂: Nginx 折腾</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/12cc604a/">技巧: WordPress upload 最终解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/173f9602/">技术: 深耕 Docker 生态圈(十一){Docker 实践}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5ac3e07f/">技巧: Wordpress 网页(h5) mp4 兼容问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/65a942dd/">技术: 深耕 Docker 生态圈(十一){Docker 三剑客}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a30c0f5f/">技术: 深耕 Docker 生态圈(十){私有仓库配置}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c73a742c/">技术: 深耕 Docker 生态圈(九){Docker 数据管理}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/19c3a85f/">技术: 深耕 Docker 生态圈(八){Docker 网络部分}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b3512db9/">技术: 深耕 Docker 生态圈(七){Docker 的底层实现}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cd70a238/">技术: 深耕 Docker 生态圈(六){Dockerfile 文法}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/36bc3b47/">技术: 深耕 Docker 生态圈(五){自己构建的镜像为何这么大}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cb3fb6f1/">技术: 深耕 Docker 生态圈(四){镜像存储在哪}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e0391b88/">技术: 深耕 Docker 生态圈(三){Docker 指令}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8abfca36/">技术: 深耕 Docker 生态圈(二){配置 Docker }</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/70ca69ad/">技术: 深耕 Docker 生态圈(一){总起:安装环境}</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9724f8c0/">传送门(Gate)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/683530b4/">略懂: Docker 镜像与容器</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ab11b0d1/">略懂: 软件架构模式</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e1b58964/">技术: Sqlite 主键自增(Python接口)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/121fc86a/">技巧: 迁移博客到 VPS (借助hook)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/337aa775/">略懂: 我所认识的 Nodejs</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/f8bb990d/">技巧: iOS 原生客户端配置 Gmail</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ecd9f8c2/">略懂: 前端相关的缓存技术</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9b49ffe2/">Golang: 深入探究 Golang 并发</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5009ef69/">技巧: macOS 录屏保存为 gif 格式</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/85a160b/">技巧: Numbers(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d3fb236/">Golang: Golang 代码走廊</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/16ca5b11/">技巧: Git 多账户工作技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7fcc01c2/">技巧: macOs下Qt的Mysql驱动处理</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e1b7f878/">技术: Qt 汇总篇</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/15783ed7/">技巧：Makefile相关</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ad67147c/">技巧: HEXO优雅操作</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/aa213556/">技巧: macOS中替换rm命令</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ef21388e/">技术: 股票分析客户端分析与实现</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/38fb8eb9/">技术: 网络编程部分汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a7d41a1/">技术: C++最终篇</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ba598705/">技术: Emacs环境配置</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3549e702/">技术: Deepin Linux环境配置</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1345f1a4/">技术: 网络吞吐量测试</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/65b929a8/">技术: 浅谈我经历的敏捷</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8804d39c/">技术: 网络开发常用工具</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6acc3344/">技术: Thrift</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8276c32/">技术: rapid-json</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/17d1767e/">技术: Rapid Xml</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/7d13442/">技术: Protocol buffer</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/140bfd50/">技术: Gtest测试框架</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/247b42a4/">技术: 多线程调试问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d48acbe2/">技术: TDD 开发模式实践</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/47fb15b8/">技术: 一个HTTPd的简单实现</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c62cfa29/">技术: C++网络库(轮子)大杂烩</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9d5b3554/">技术: Asio 异步IO库</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e5af6e18/">技术: Boost库</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3cd43f14/">技术: Unix Domain Socket</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/87cd3741/">技术: 百万连接问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1d57da8b/">技术: C++ 实现线程池模型</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6b518c8a/">技术: 服务端网络模型</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e42d6398/">技术: UDP 模型网络编程</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/224e60da/">技术: TCP 模型网络编程</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/df7a2188/">技术: TCP流解析(粘包和拆包问题)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1334152b/">技术: Epoll 模型</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8967f437/">技术: Linux 基础套接字模型</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/81fba862/">技术: Linux网络学习参考</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a4602dea/">技术: Linux网络IO模型</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cf64f3cd/">技术: Shell代码规范</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/33327382/">技术: 开源协议</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/be94ecde/">技术: Git 代码规范</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1a10be5a/">技术: Python代码规范</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cc8315f3/">技术: 高质量Git工作</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3a357315/">技术: Python语言</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/82524a2d/">技术: Qt 网络编程案例汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a46fcd49/">技术: Qt 线程案例汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e3b79a82/">技巧: linux下查看二进制文件</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5d0a2cfa/">技术: Qt 实践(汽车销量管理)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/77d8483b/">技巧: Qt 快捷键</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/75110831/">技术: JNI</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/fdc9b2b9/">技术: C++编程之time问题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e6ff0a80/">技术: C++11 Lambda 再探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b84fe139/">技术: 对比 Linux 下并发库</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/322ce852/">技术: C++11 特性补充</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/189d21c8/">技术: benchmark(lambda 和 bind)</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/97d0104d/">技术: C++11 可调用对象function总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d12695b6/">技术: C++11 std::ref 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b43344a7/">技术: C++ 智能指针实现</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4ead806a/">技术: C++11 Bind 探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/9ef88011/">技术: C++ RAII 相关技术总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/bb36bf0d/">技术: C++11 Lambda 探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4b19001a/">技术: Linux Bin Utils</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/31dce1ea/">技术: C++ 智能指针</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/88802625/">技术: Linux 静态&动态库</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/ab21303c/">技术: C++11 并发库</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/bc67b8cb/">技术: 探究一下STL常用算法</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/640d4b5f/">技术: Linux 编程三大件儿</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/24da8a94/">技术: C++ 迭代器失效问题</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e53c44b8/">技术: C++ 标准库 STL</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/f4144d45/">技术: C++非面向对象部分</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/f8283c77/">技术: C++面向对象部分</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/be09a73/">技术: 设计模式 C++ 实现</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/956ee661/">技术: mysql-connector-cpp</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b0dbc55e/">技术: 带有移动语义的 C++ 字符串类</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/f306f9f9/">技术: C++11 右值相关问题探讨</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e9705375/">技术: C++11 类型萃取</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d93a00e8/">技术: C++11 异常争论</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b7fe58b8/">技术: C++11 模板别名探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/72ae9d55/">技术: C++11 默认函数问题探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a8af70c7/">技术: C++11 auto和decltype总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/c8bce253/">技术: Java中正则表达式支持</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/866a6247/">技术: Python中正则表达式的支持</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/8ebc387/">技术: C++中正则表达式的支持</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/50c77f46/">技术: C语言中正则表达式的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/aea53521/">技术: C++11 tuple 容器</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/656a02b/">技术: C++11 hashtable 结构</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4bb5bf03/">技术: C++11 一致性初始化探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/e6f297fb/">技术: C++11 RangeFor探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/70b6b9e7/">技术: C++11 explicit注意事项</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/919162f1/">技术: C++11 nullptr探究</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b744aae/">技术: C++11变长参数模板</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5f4ce2b/">技术: 探究 Linux 线程</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1312cbe7/">技术: 探究 Linux 进程</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1d2bfb39/">技术: Posix标准一览</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/a00e5a90/">隐修者(里程碑)</a></li></ul>




    <script>
        
            yiliaConfig.fancybox = false;
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2018 &nbsp Merlin
            </div>
            <div class="footer-right">
                 blog&nbsp<b>version: </b> &nbsp<a href= "https://github.com/WizardMerlin/Gate#blog版本分支说明" >2.4</a>    <i class="fa fa-heart animated infinite pulse"></i>&nbsp高效流
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 1;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-110654443-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "Do One Thing......" + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "Do It Well......" + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>